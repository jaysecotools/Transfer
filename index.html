The error "contextSnippet is not defined" occurs because you're using a function called contextSnippet in your code, but it's not defined anywhere. This function is supposed to provide context around matches for better preview display.

Add this function to your JavaScript code, preferably in the "Utilities" section:

```javascript
/* --- Context snippet utility --- */
function contextSnippet(text, start, end, contextLength = 30) {
  // Get context around the match
  const contextStart = Math.max(0, start - contextLength);
  const contextEnd = Math.min(text.length, end + contextLength);
  
  let snippet = text.slice(contextStart, contextEnd);
  
  // Add ellipsis if we truncated the beginning
  if (contextStart > 0) {
    snippet = '...' + snippet;
  }
  
  // Add ellipsis if we truncated the end
  if (contextEnd < text.length) {
    snippet = snippet + '...';
  }
  
  return snippet;
}
```

Add this code right before the /* --- File handling --- */ section, or anywhere in your utilities section. This function:

1. Takes the text, start/end positions of the match, and an optional context length
2. Extracts text around the match (30 characters by default)
3. Adds ellipsis (...) if the context is truncated at either end
4. Returns a readable snippet that shows where the match occurs in context

The context snippet helps users understand the match better in the preview modal by showing the surrounding text rather than just the matched text alone.
