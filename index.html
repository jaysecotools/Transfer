<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Ecosystem Maintenance Tool | AHCECR301 Compliance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        .sidebar {
            min-height: 100vh;
            background-color: var(--primary-color);
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: var(--secondary-color);
            transform: translateX(5px);
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .main-content {
            background-color: #f8f9fa;
            padding: 20px;
            min-height: 100vh;
        }
        .card {
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .map-container {
            height: 400px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
        }
        .species-card {
            transition: transform 0.2s;
        }
        .species-card:hover {
            transform: translateY(-5px);
        }
        .risk-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .risk-low {
            background-color: var(--success-color);
        }
        .risk-medium {
            background-color: var(--warning-color);
        }
        .risk-high {
            background-color: var(--danger-color);
        }
        .logo {
            font-weight: 700;
            padding: 15px;
            font-size: 1.2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background-color: var(--secondary-color);
        }
        #map { 
            height: 100%;
            width: 100%;
            border-radius: 5px;
        }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .leaflet-top.leaflet-right {
            margin-top: 50px;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }
        .form-control.is-invalid {
            background-image: none;
            padding-right: 0.75rem;
        }
        .form-control.is-valid {
            background-image: none;
            padding-right: 0.75rem;
        }
        .fc-event {
            cursor: pointer;
        }
        .species-image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
            border-radius: 5px;
        }
        .assessment-image-preview {
            max-width: 100%;
            max-height: 150px;
            margin-top: 10px;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-thumbnail {
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .fc-event-title {
            white-space: normal;
        }
        .fc-daygrid-event-dot {
            display: none;
        }
        .dashboard-stat {
            text-align: center;
            padding: 15px;
            border-radius: 5px;
            color: white;
            margin-bottom: 15px;
        }
        .stat-tasks {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
        }
        .stat-assessments {
            background: linear-gradient(45deg, var(--success-color), #2ecc71);
        }
        .stat-species {
            background: linear-gradient(45deg, var(--warning-color), #f1c40f);
        }
        .stat-compliance {
            background: linear-gradient(45deg, var(--danger-color), #e67e22);
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #dee2e6;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .table-responsive {
            overflow-x: auto;
        }
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
            }
            .main-content {
                padding: 10px;
            }
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="toast-container">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Operation completed successfully.
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-0">
                <div class="logo">EcoMaintain</div>
                <ul class="nav flex-column p-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#site-assessment" data-bs-toggle="tab">
                            <i class="bi bi-clipboard-data"></i> Site Assessment
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#maintenance-plan" data-bs-toggle="tab">
                            <i class="bi bi-calendar-check"></i> Maintenance Plan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#species-register" data-bs-toggle="tab">
                            <i class="bi bi-tree"></i> Species Register
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#monitoring" data-bs-toggle="tab">
                            <i class="bi bi-binoculars"></i> Monitoring
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reports" data-bs-toggle="tab">
                            <i class="bi bi-file-earmark-text"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#legislation" data-bs-toggle="tab">
                            <i class="bi bi-journal-bookmark"></i> Legislation
                        </a>
                    </li>
                    <li class="nav-item mt-4">
                        <a class="nav-link" href="#settings" data-bs-toggle="tab">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 ms-sm-auto main-content">
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Native Ecosystem Maintenance Dashboard</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <div class="btn-group me-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="exportDashboard">Export</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="printDashboard">Print</button>
                                </div>
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newActivityModal">
                                    <i class="bi bi-plus"></i> New Activity
                                </button>
                            </div>
                        </div>

                        <!-- Dashboard Stats -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="dashboard-stat stat-tasks">
                                    <h3 id="totalTasks">0</h3>
                                    <p>Upcoming Tasks</p>
                                    <i class="bi bi-list-task"></i>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-stat stat-assessments">
                                    <h3 id="totalAssessments">0</h3>
                                    <p>Assessments</p>
                                    <i class="bi bi-clipboard-data"></i>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-stat stat-species">
                                    <h3 id="totalSpecies">0</h3>
                                    <p>Species</p>
                                    <i class="bi bi-tree"></i>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-stat stat-compliance">
                                    <h3 id="compliancePercent">0%</h3>
                                    <p>Compliance</p>
                                    <i class="bi bi-check-circle"></i>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Upcoming Tasks</h5>
                                        <div class="loading-spinner" id="tasksLoading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="list-group" id="upcomingTasksList">
                                            <!-- Tasks will be loaded here dynamically -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Site Health Indicators</h5>
                                        <canvas id="healthChart" height="200"></canvas>
                                        <div class="mt-3" id="healthIndicators">
                                            <!-- Indicators will be loaded here dynamically -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Recent Observations</h5>
                                        <ul class="list-group list-group-flush" id="recentObservationsList">
                                            <!-- Observations will be loaded here dynamically -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Site Map</h5>
                                        <div class="map-container p-3">
                                            <div id="map"></div>
                                            <div class="map-controls">
                                                <div class="btn-group-vertical">
                                                    <button id="zoneToggle" class="btn btn-sm btn-outline-primary active">Zones</button>
                                                    <button id="vegetationToggle" class="btn btn-sm btn-outline-success">Vegetation</button>
                                                    <button id="weedsToggle" class="btn btn-sm btn-outline-danger">Weeds</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Compliance Checklist</h5>
                                        <div id="complianceChecklist">
                                            <!-- Checklist will be loaded here dynamically -->
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-success" id="complianceProgress" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0% Complete</div>
                                        </div>
                                        <button class="btn btn-sm btn-primary mt-3" id="generateComplianceReport">Generate Compliance Report</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Site Assessment Tab -->
                    <div class="tab-pane fade" id="site-assessment">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Site Assessment</h1>
                            <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newAssessmentModal">
                                <i class="bi bi-plus"></i> New Assessment
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">New Site Assessment</h5>
                                <form id="newAssessmentForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="assessmentDate" class="form-label">Assessment Date *</label>
                                            <input type="date" class="form-control" id="assessmentDate" required>
                                            <div class="invalid-feedback">Please provide a valid date.</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="assessorName" class="form-label">Assessor Name *</label>
                                            <input type="text" class="form-control" id="assessorName" required>
                                            <div class="invalid-feedback">Please provide the assessor's name.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="siteDescription" class="form-label">Site Description *</label>
                                        <textarea class="form-control" id="siteDescription" rows="3" required></textarea>
                                        <div class="invalid-feedback">Please provide a site description.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Ecosystem Components Present *</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="flora" name="components" value="flora">
                                                    <label class="form-check-label" for="flora">Flora</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="fauna" name="components" value="fauna">
                                                    <label class="form-check-label" for="fauna">Fauna</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="soil" name="components" value="soil">
                                                    <label class="form-check-label" for="soil">Soil</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="water" name="components" value="water">
                                                    <label class="form-check-label" for="water">Water</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="geology" name="components" value="geology">
                                                    <label class="form-check-label" for="geology">Geology</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="climate" name="components" value="climate">
                                                    <label class="form-check-label" for="climate">Climate</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback" id="componentsFeedback">Please select at least one component.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="ecosystemHealth" class="form-label">Ecosystem Health Assessment *</label>
                                        <select class="form-select" id="ecosystemHealth" required>
                                            <option value="" selected disabled>Select health rating...</option>
                                            <option value="excellent">Excellent - Minimal disturbance</option>
                                            <option value="good">Good - Some disturbance but recovering</option>
                                            <option value="fair">Fair - Moderate disturbance</option>
                                            <option value="poor">Poor - Significant disturbance</option>
                                            <option value="degraded">Degraded - Severe disturbance</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a health rating.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="threats" class="form-label">Identified Threats</label>
                                        <select class="form-select" id="threats" multiple>
                                            <option value="weeds">Weeds</option>
                                            <option value="pests">Pests</option>
                                            <option value="erosion">Erosion</option>
                                            <option value="fire">Fire</option>
                                            <option value="climate">Climate change</option>
                                            <option value="development">Development</option>
                                            <option value="recreation">Recreational impacts</option>
                                            <option value="grazing">Grazing</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="assessmentPhotos" class="form-label">Upload Photos</label>
                                        <input class="form-control" type="file" id="assessmentPhotos" multiple accept="image/*">
                                        <div class="image-preview-container" id="assessmentPhotoPreview"></div>
                                    </div>

                                    <button type="submit" class="btn btn-primary">Save Assessment</button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Previous Assessments</h5>
                                <div class="loading-spinner" id="assessmentsLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="assessmentsTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Assessor</th>
                                                <th>Health Rating</th>
                                                <th>Main Threats</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Assessments will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance Plan Tab -->
                    <div class="tab-pane fade" id="maintenance-plan">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Maintenance Plan</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newActivityModal">
                                    <i class="bi bi-plus"></i> New Activity
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Maintenance Activities</h5>
                                <ul class="nav nav-tabs" id="maintenanceTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab">Upcoming</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">Completed</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="overdue-tab" data-bs-toggle="tab" data-bs-target="#overdue" type="button" role="tab">Overdue</button>
                                    </li>
                                </ul>
                                <div class="tab-content p-3 border border-top-0 rounded-bottom">
                                    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
                                        <div class="loading-spinner" id="upcomingActivitiesLoading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="upcomingActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Scheduled</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Upcoming activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="completed" role="tabpanel">
                                        <div class="loading-spinner" id="completedActivitiesLoading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="completedActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Completed</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Completed activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="overdue" role="tabpanel">
                                        <div class="loading-spinner" id="overdueActivitiesLoading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="overdueActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Due Date</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Overdue activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">Maintenance Calendar</h5>
                                <div id="calendar" style="height: 600px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Species Register Tab -->
                    <div class="tab-pane fade" id="species-register">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Species Register</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <div class="btn-group me-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="exportSpecies">Export</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="printSpecies">Print</button>
                                </div>
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newSpeciesModal">
                                    <i class="bi bi-plus"></i> New Species
                                </button>
                            </div>
                        </div>

                        <div class="row mb-4" id="speciesCardsContainer">
                            <!-- Species cards will be loaded here dynamically -->
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Species List</h5>
                                <div class="loading-spinner" id="speciesLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="speciesTable">
                                        <thead>
                                            <tr>
                                                <th>Scientific Name</th>
                                                <th>Common Name</th>
                                                <th>Type</th>
                                                <th>Status</th>
                                                <th>Last Observed</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Species will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monitoring Tab -->
                    <div class="tab-pane fade" id="monitoring">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Monitoring</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newMonitoringModal">
                                    <i class="bi bi-plus"></i> New Monitoring
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Fauna Monitoring</h5>
                                        <canvas id="faunaChart" height="200"></canvas>
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#newFaunaSightingModal">Add Sighting</button>
                                            <button class="btn btn-sm btn-outline-secondary" id="viewAllFauna">View All</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Vegetation Monitoring</h5>
                                        <canvas id="vegetationChart" height="200"></canvas>
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#newVegetationSurveyModal">Add Survey</button>
                                            <button class="btn btn-sm btn-outline-secondary" id="viewAllVegetation">View All</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">Recent Monitoring Activities</h5>
                                <div class="loading-spinner" id="monitoringLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="monitoringTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Location</th>
                                                <th>Observer</th>
                                                <th>Findings</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Monitoring activities will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div class="tab-pane fade" id="reports">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Reports</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#generateReportModal">
                                    <i class="bi bi-file-earmark-plus"></i> Generate Report
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Compliance Report</h5>
                                        <p class="card-text">Generate a report showing compliance with AHCECR301 requirements.</p>
                                        <button class="btn btn-primary" onclick="generateReport('compliance')">Generate</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Maintenance Summary</h5>
                                        <p class="card-text">Summary of all maintenance activities for a selected period.</p>
                                        <button class="btn btn-primary" onclick="generateReport('maintenance')">Generate</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Monitoring Summary</h5>
                                        <p class="card-text">Summary of monitoring activities and findings.</p>
                                        <button class="btn btn-primary" onclick="generateReport('monitoring')">Generate</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Ecosystem Health Trend</h5>
                                        <p class="card-text">Generate a trend report showing changes in ecosystem health over time.</p>
                                        <button class="btn btn-primary" onclick="generateReport('health-trend')">Generate</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Threat Management</h5>
                                        <p class="card-text">Report on threats and management actions taken.</p>
                                        <button class="btn btn-primary" onclick="generateReport('threat-management')">Generate</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">Previous Reports</h5>
                                <div class="loading-spinner" id="reportsLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="reportsTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Report Type</th>
                                                <th>Generated By</th>
                                                <th>Period</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Reports will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Legislation Tab -->
                    <div class="tab-pane fade" id="legislation">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Legislation & Compliance</h1>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Relevant Legislation</h5>
                                <div class="accordion" id="legislationAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingOne">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                                Environment Protection and Biodiversity Conservation Act 1999 (EPBC Act)
                                            </button>
                                        </h2>
                                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#legislationAccordion">
                                            <div class="accordion-body">
                                                <p>The EPBC Act is the Australian Government's central piece of environmental legislation. It provides a legal framework to protect and manage nationally and internationally important flora, fauna, ecological communities and heritage places.</p>
                                                <p><strong>Key requirements:</strong></p>
                                                <ul>
                                                    <li>Identification and protection of threatened species and ecological communities</li>
                                                    <li>Regulation of actions that may impact matters of national environmental significance</li>
                                                    <li>Promotion of ecologically sustainable development</li>
                                                </ul>
                                                <a href="https://www.environment.gov.au/epbc" target="_blank" class="btn btn-sm btn-outline-primary">More Information</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingTwo">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                                State/Territory Environmental Legislation
                                            </button>
                                        </h2>
                                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#legislationAccordion">
                                            <div class="accordion-body">
                                                <p>Each state and territory has its own environmental protection and biodiversity conservation legislation that operates alongside the EPBC Act.</p>
                                                <div class="table-responsive">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Jurisdiction</th>
                                                                <th>Primary Legislation</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>NSW</td>
                                                                <td>Biodiversity Conservation Act 2016</td>
                                                            </tr>
                                                            <tr>
                                                                <td>VIC</td>
                                                                <td>Flora and Fauna Guarantee Act 1988</td>
                                                            </tr>
                                                            <tr>
                                                                <td>QLD</td>
                                                                <td>Nature Conservation Act 1992</td>
                                                            </tr>
                                                            <tr>
                                                                <td>WA</td>
                                                                <td>Biodiversity Conservation Act 2016</td>
                                                            </tr>
                                                            <tr>
                                                                <td>SA</td>
                                                                <td>National Parks and Wildlife Act 1972</td>
                                                            </tr>
                                                            <tr>
                                                                <td>TAS</td>
                                                                <td>Nature Conservation Act 2002</td>
                                                            </tr>
                                                            <tr>
                                                                <td>ACT</td>
                                                                <td>Nature Conservation Act 2014</td>
                                                            </tr>
                                                            <tr>
                                                                <td>NT</td>
                                                                <td>Territory Parks and Wildlife Conservation Act 2000</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingThree">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                                Local Government Regulations
                                            </button>
                                        </h2>
                                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#legislationAccordion">
                                            <div class="accordion-body">
                                                <p>Local governments often have additional planning schemes, local laws and policies that affect native ecosystem management.</p>
                                                <p><strong>Common local regulations include:</strong></p>
                                                <ul>
                                                    <li>Tree preservation orders</li>
                                                    <li>Vegetation clearing controls</li>
                                                    <li>Weed control requirements</li>
                                                    <li>Bushfire management provisions</li>
                                                </ul>
                                                <p>Check with your local council for specific requirements in your area.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">Compliance Checklist</h5>
                                <p>This checklist helps ensure your activities comply with relevant legislation and the requirements of AHCECR301.</p>
                                
                                <div class="loading-spinner" id="complianceLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="complianceChecklistTable">
                                        <thead>
                                            <tr>
                                                <th>Requirement</th>
                                                <th>Compliant?</th>
                                                <th>Evidence</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Compliance checklist will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                                <button class="btn btn-primary mt-3" id="saveComplianceChecklist">Save Compliance Checklist</button>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane fade" id="settings">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Settings</h1>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">User Profile</h5>
                                        <form id="userProfileForm">
                                            <div class="mb-3">
                                                <label for="userName" class="form-label">Full Name *</label>
                                                <input type="text" class="form-control" id="userName" required>
                                                <div class="invalid-feedback">Please provide your full name.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="userEmail" class="form-label">Email *</label>
                                                <input type="email" class="form-control" id="userEmail" required>
                                                <div class="invalid-feedback">Please provide a valid email.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="userRole" class="form-label">Role *</label>
                                                <select class="form-select" id="userRole" required>
                                                    <option value="" selected disabled>Select role...</option>
                                                    <option value="administrator">Administrator</option>
                                                    <option value="ecologist">Ecologist</option>
                                                    <option value="field-technician">Field Technician</option>
                                                    <option value="volunteer">Volunteer</option>
                                                </select>
                                                <div class="invalid-feedback">Please select a role.</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Update Profile</button>
                                        </form>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Change Password</h5>
                                        <form id="changePasswordForm">
                                            <div class="mb-3">
                                                <label for="currentPassword" class="form-label">Current Password *</label>
                                                <input type="password" class="form-control" id="currentPassword" required>
                                                <div class="invalid-feedback">Please enter your current password.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="newPassword" class="form-label">New Password *</label>
                                                <input type="password" class="form-control" id="newPassword" required minlength="8">
                                                <div class="invalid-feedback">Password must be at least 8 characters.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="confirmPassword" class="form-label">Confirm New Password *</label>
                                                <input type="password" class="form-control" id="confirmPassword" required>
                                                <div class="invalid-feedback">Passwords must match.</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Change Password</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Site Settings</h5>
                                        <form id="siteSettingsForm">
                                            <div class="mb-3">
                                                <label for="siteName" class="form-label">Site Name *</label>
                                                <input type="text" class="form-control" id="siteName" required>
                                                <div class="invalid-feedback">Please provide a site name.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="siteLocation" class="form-label">Location *</label>
                                                <input type="text" class="form-control" id="siteLocation" required>
                                                <div class="invalid-feedback">Please provide the site location.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="siteArea" class="form-label">Area (hectares) *</label>
                                                <input type="number" class="form-control" id="siteArea" required min="0" step="0.1">
                                                <div class="invalid-feedback">Please provide a valid area.</div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="siteDescription" class="form-label">Description *</label>
                                                <textarea class="form-control" id="siteDescription" rows="3" required></textarea>
                                                <div class="invalid-feedback">Please provide a site description.</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Update Site Details</button>
                                        </form>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Data Management</h5>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-secondary" id="exportAllData">Export All Data</button>
                                            <button class="btn btn-outline-secondary" id="backupDatabase">Backup Database</button>
                                            <button class="btn btn-outline-danger" id="resetTestData">Reset Test Data</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- New Activity Modal -->
    <div class="modal fade" id="newActivityModal" tabindex="-1" aria-labelledby="newActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newActivityModalLabel">New Maintenance Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="activityForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="activityType" class="form-label">Activity Type *</label>
                                <select class="form-select" id="activityType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="weed-control">Weed Control</option>
                                    <option value="revegetation">Revegetation</option>
                                    <option value="erosion-control">Erosion Control</option>
                                    <option value="fauna-survey">Fauna Survey</option>
                                    <option value="vegetation-survey">Vegetation Survey</option>
                                    <option value="water-quality">Water Quality Testing</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select an activity type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="activityTitle" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="activityTitle" required>
                                <div class="invalid-feedback">Please provide a title.</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="activityStartDate" class="form-label">Start Date *</label>
                                <input type="datetime-local" class="form-control" id="activityStartDate" required>
                                <div class="invalid-feedback">Please provide a start date.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="activityEndDate" class="form-label">End Date</label>
                                <input type="datetime-local" class="form-control" id="activityEndDate">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="activityLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="activityLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityDescription" class="form-label">Description *</label>
                            <textarea class="form-control" id="activityDescription" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide a description.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityAssignedTo" class="form-label">Assigned To *</label>
                            <input type="text" class="form-control" id="activityAssignedTo" required>
                            <div class="invalid-feedback">Please specify who this is assigned to.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityPriority" class="form-label">Priority</label>
                            <select class="form-select" id="activityPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="activityStatus" class="form-label">Status</label>
                            <select class="form-select" id="activityStatus">
                                <option value="planned">Planned</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="activityNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="activityNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveActivity">Save Activity</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Assessment Modal -->
    <div class="modal fade" id="newAssessmentModal" tabindex="-1" aria-labelledby="newAssessmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newAssessmentModalLabel">New Site Assessment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newAssessmentForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="assessmentDate" class="form-label">Assessment Date *</label>
                                <input type="date" class="form-control" id="assessmentDate" required>
                                <div class="invalid-feedback">Please provide a valid date.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="assessorName" class="form-label">Assessor Name *</label>
                                <input type="text" class="form-control" id="assessorName" required>
                                <div class="invalid-feedback">Please provide the assessor's name.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="siteDescription" class="form-label">Site Description *</label>
                            <textarea class="form-control" id="siteDescription" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide a site description.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Ecosystem Components Present *</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="flora" name="components" value="flora">
                                        <label class="form-check-label" for="flora">Flora</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="fauna" name="components" value="fauna">
                                        <label class="form-check-label" for="fauna">Fauna</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="soil" name="components" value="soil">
                                        <label class="form-check-label" for="soil">Soil</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="water" name="components" value="water">
                                        <label class="form-check-label" for="water">Water</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="geology" name="components" value="geology">
                                        <label class="form-check-label" for="geology">Geology</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="climate" name="components" value="climate">
                                        <label class="form-check-label" for="climate">Climate</label>
                                    </div>
                                </div>
                            </div>
                            <div class="invalid-feedback" id="componentsFeedback">Please select at least one component.</div>
                        </div>

                        <div class="mb-3">
                            <label for="ecosystemHealth" class="form-label">Ecosystem Health Assessment *</label>
                            <select class="form-select" id="ecosystemHealth" required>
                                <option value="" selected disabled>Select health rating...</option>
                                <option value="excellent">Excellent - Minimal disturbance</option>
                                <option value="good">Good - Some disturbance but recovering</option>
                                <option value="fair">Fair - Moderate disturbance</option>
                                <option value="poor">Poor - Significant disturbance</option>
                                <option value="degraded">Degraded - Severe disturbance</option>
                            </select>
                            <div class="invalid-feedback">Please select a health rating.</div>
                        </div>

                        <div class="mb-3">
                            <label for="threats" class="form-label">Identified Threats</label>
                            <select class="form-select" id="threats" multiple>
                                <option value="weeds">Weeds</option>
                                <option value="pests">Pests</option>
                                <option value="erosion">Erosion</option>
                                <option value="fire">Fire</option>
                                <option value="climate">Climate change</option>
                                <option value="development">Development</option>
                                <option value="recreation">Recreational impacts</option>
                                <option value="grazing">Grazing</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="assessmentPhotos" class="form-label">Upload Photos</label>
                            <input class="form-control" type="file" id="assessmentPhotos" multiple accept="image/*">
                            <div class="image-preview-container" id="assessmentPhotoPreview"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveAssessment">Save Assessment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Species Modal -->
    <div class="modal fade" id="newSpeciesModal" tabindex="-1" aria-labelledby="newSpeciesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newSpeciesModalLabel">New Species Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="speciesForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesScientificName" class="form-label">Scientific Name *</label>
                                <input type="text" class="form-control" id="speciesScientificName" required>
                                <div class="invalid-feedback">Please provide the scientific name.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="speciesCommonName" class="form-label">Common Name</label>
                                <input type="text" class="form-control" id="speciesCommonName">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesType" class="form-label">Type *</label>
                                <select class="form-select" id="speciesType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="flora">Flora</option>
                                    <option value="fauna">Fauna</option>
                                    <option value="fungi">Fungi</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select a type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="speciesStatus" class="form-label">Status *</label>
                                <select class="form-select" id="speciesStatus" required>
                                    <option value="" selected disabled>Select status...</option>
                                    <option value="native">Native</option>
                                    <option value="introduced">Introduced</option>
                                    <option value="weed">Weed</option>
                                    <option value="pest">Pest</option>
                                    <option value="endangered">Endangered</option>
                                    <option value="vulnerable">Vulnerable</option>
                                    <option value="threatened">Threatened</option>
                                </select>
                                <div class="invalid-feedback">Please select a status.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="speciesDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="speciesDescription" rows="3"></textarea>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesHabitat" class="form-label">Habitat</label>
                                <input type="text" class="form-control" id="speciesHabitat">
                            </div>
                            <div class="col-md-6">
                                <label for="speciesLastObserved" class="form-label">Last Observed</label>
                                <input type="date" class="form-control" id="speciesLastObserved">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="speciesImage" class="form-label">Image</label>
                            <input class="form-control" type="file" id="speciesImage" accept="image/*">
                            <img id="speciesImagePreview" class="species-image-preview" src="#" alt="Species image preview">
                        </div>

                        <div class="mb-3">
                            <label for="speciesNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="speciesNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSpecies">Save Species</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Monitoring Modal -->
    <div class="modal fade" id="newMonitoringModal" tabindex="-1" aria-labelledby="newMonitoringModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newMonitoringModalLabel">New Monitoring Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="monitoringForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="monitoringType" class="form-label">Monitoring Type *</label>
                                <select class="form-select" id="monitoringType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="fauna-survey">Fauna Survey</option>
                                    <option value="vegetation-survey">Vegetation Survey</option>
                                    <option value="water-quality">Water Quality Testing</option>
                                    <option value="weed-mapping">Weed Mapping</option>
                                    <option value="erosion-monitoring">Erosion Monitoring</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select a monitoring type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="monitoringDate" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="monitoringDate" required>
                                <div class="invalid-feedback">Please provide a date.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="monitoringLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringObserver" class="form-label">Observer *</label>
                            <input type="text" class="form-control" id="monitoringObserver" required>
                            <div class="invalid-feedback">Please specify the observer.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringFindings" class="form-label">Findings *</label>
                            <textarea class="form-control" id="monitoringFindings" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide findings.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringSpecies" class="form-label">Species Observed (if applicable)</label>
                            <select class="form-select" id="monitoringSpecies" multiple>
                                <!-- Species options will be loaded here dynamically -->
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringPhotos" class="form-label">Upload Photos</label>
                            <input class="form-control" type="file" id="monitoringPhotos" multiple accept="image/*">
                            <div class="image-preview-container" id="monitoringPhotoPreview"></div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="monitoringNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMonitoring">Save Monitoring</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Fauna Sighting Modal -->
    <div class="modal fade" id="newFaunaSightingModal" tabindex="-1" aria-labelledby="newFaunaSightingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newFaunaSightingModalLabel">New Fauna Sighting</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="faunaSightingForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="faunaSpecies" class="form-label">Species *</label>
                                <select class="form-select" id="faunaSpecies" required>
                                    <option value="" selected disabled>Select species...</option>
                                    <!-- Species options will be loaded here dynamically -->
                                </select>
                                <div class="invalid-feedback">Please select a species.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="faunaDate" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="faunaDate" required>
                                <div class="invalid-feedback">Please provide a date.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="faunaLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="faunaLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="faunaObserver" class="form-label">Observer *</label>
                            <input type="text" class="form-control" id="faunaObserver" required>
                            <div class="invalid-feedback">Please specify the observer.</div>
                        </div>

                        <div class="mb-3">
                            <label for="faunaCount" class="form-label">Count</label>
                            <input type="number" class="form-control" id="faunaCount" min="1" value="1">
                        </div>

                        <div class="mb-3">
                            <label for="faunaBehavior" class="form-label">Behavior/Observations</label>
                            <textarea class="form-control" id="faunaBehavior" rows="3"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="faunaPhotos" class="form-label">Upload Photos</label>
                            <input class="form-control" type="file" id="faunaPhotos" multiple accept="image/*">
                            <div class="image-preview-container" id="faunaPhotoPreview"></div>
                        </div>

                        <div class="mb-3">
                            <label for="faunaNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="faunaNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveFaunaSighting">Save Sighting</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Vegetation Survey Modal -->
    <div class="modal fade" id="newVegetationSurveyModal" tabindex="-1" aria-labelledby="newVegetationSurveyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newVegetationSurveyModalLabel">New Vegetation Survey</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="vegetationSurveyForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="vegetationDate" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="vegetationDate" required>
                                <div class="invalid-feedback">Please provide a date.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="vegetationObserver" class="form-label">Observer *</label>
                                <input type="text" class="form-control" id="vegetationObserver" required>
                                <div class="invalid-feedback">Please specify the observer.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="vegetationLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="vegetationLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="vegetationSpecies" class="form-label">Species Observed</label>
                            <select class="form-select" id="vegetationSpecies" multiple>
                                <!-- Species options will be loaded here dynamically -->
                            </select>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="vegetationCover" class="form-label">Native Cover (%)</label>
                                <input type="number" class="form-control" id="vegetationCover" min="0" max="100" step="1">
                            </div>
                            <div class="col-md-4">
                                <label for="vegetationWeedCover" class="form-label">Weed Cover (%)</label>
                                <input type="number" class="form-control" id="vegetationWeedCover" min="0" max="100" step="1">
                            </div>
                            <div class="col-md-4">
                                <label for="vegetationHealth" class="form-label">Health Rating</label>
                                <select class="form-select" id="vegetationHealth">
                                    <option value="" selected disabled>Select rating...</option>
                                    <option value="excellent">Excellent</option>
                                    <option value="good">Good</option>
                                    <option value="fair">Fair</option>
                                    <option value="poor">Poor</option>
                                    <option value="degraded">Degraded</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="vegetationFindings" class="form-label">Findings *</label>
                            <textarea class="form-control" id="vegetationFindings" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide findings.</div>
                        </div>

                        <div class="mb-3">
                            <label for="vegetationPhotos" class="form-label">Upload Photos</label>
                            <input class="form-control" type="file" id="vegetationPhotos" multiple accept="image/*">
                            <div class="image-preview-container" id="vegetationPhotoPreview"></div>
                        </div>

                        <div class="mb-3">
                            <label for="vegetationNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="vegetationNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveVegetationSurvey">Save Survey</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Assessment Modal -->
    <div class="modal fade" id="viewAssessmentModal" tabindex="-1" aria-labelledby="viewAssessmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewAssessmentModalLabel">Assessment Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="assessmentModalBody">
                    <!-- Assessment details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printAssessment">Print</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generate Report Modal -->
    <div class="modal fade" id="generateReportModal" tabindex="-1" aria-labelledby="generateReportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="generateReportModalLabel">Generate Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reportForm">
                        <div class="mb-3">
                            <label for="reportType" class="form-label">Report Type *</label>
                            <select class="form-select" id="reportType" required>
                                <option value="" selected disabled>Select report type...</option>
                                <option value="compliance">Compliance Report</option>
                                <option value="maintenance">Maintenance Summary</option>
                                <option value="monitoring">Monitoring Summary</option>
                                <option value="health-trend">Ecosystem Health Trend</option>
                                <option value="threat-management">Threat Management</option>
                            </select>
                            <div class="invalid-feedback">Please select a report type.</div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="reportStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="reportStartDate">
                            </div>
                            <div class="col-md-6">
                                <label for="reportEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="reportEndDate">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="reportFormat" class="form-label">Format *</label>
                            <select class="form-select" id="reportFormat" required>
                                <option value="pdf" selected>PDF</option>
                                <option value="excel">Excel</option>
                                <option value="word">Word</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="generateReportBtn">Generate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Report Modal -->
    <div class="modal fade" id="viewReportModal" tabindex="-1" aria-labelledby="viewReportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewReportModalLabel">Report Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="reportModalBody">
                    <!-- Report content will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="downloadReport">Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Species Modal -->
    <div class="modal fade" id="viewSpeciesModal" tabindex="-1" aria-labelledby="viewSpeciesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewSpeciesModalLabel">Species Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="speciesModalBody">
                    <!-- Species details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printSpeciesDetails">Print</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Activity Modal -->
    <div class="modal fade" id="viewActivityModal" tabindex="-1" aria-labelledby="viewActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewActivityModalLabel">Activity Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="activityModalBody">
                    <!-- Activity details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printActivity">Print</button>
                    <button type="button" class="btn btn-success" id="completeActivity">Mark Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Monitoring Modal -->
    <div class="modal fade" id="viewMonitoringModal" tabindex="-1" aria-labelledby="viewMonitoringModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewMonitoringModalLabel">Monitoring Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="monitoringModalBody">
                    <!-- Monitoring details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printMonitoring">Print</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmationModalBody">
                    Are you sure you want to perform this action?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmAction">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script>
        // Data storage and management
        const db = {
            assessments: JSON.parse(localStorage.getItem('assessments')) || [],
            species: JSON.parse(localStorage.getItem('species')) || [],
            activities: JSON.parse(localStorage.getItem('activities')) || [],
            monitoring: JSON.parse(localStorage.getItem('monitoring')) || [],
            reports: JSON.parse(localStorage.getItem('reports')) || [],
            faunaSightings: JSON.parse(localStorage.getItem('faunaSightings')) || [],
            vegetationSurveys: JSON.parse(localStorage.getItem('vegetationSurveys')) || [],
            complianceChecklist: JSON.parse(localStorage.getItem('complianceChecklist')) || [
                { id: 1, requirement: "Identified all relevant legislation", compliant: "", evidence: "", notes: "" },
                { id: 2, requirement: "Assessed impacts on protected matters", compliant: "", evidence: "", notes: "" },
                { id: 3, requirement: "Obtained necessary permits/approvals", compliant: "", evidence: "", notes: "" },
                { id: 4, requirement: "Implemented required protections", compliant: "", evidence: "", notes: "" },
                { id: 5, requirement: "Maintained required records", compliant: "", evidence: "", notes: "" }
            ],
            settings: JSON.parse(localStorage.getItem('settings')) || {
                siteName: "Blue Mountains Conservation Area",
                siteLocation: "NSW, Australia",
                siteArea: 125,
                siteDescription: "Mixed eucalypt forest with significant biodiversity values including several threatened species.",
                userProfile: {
                    name: "John Doe",
                    email: "john.doe@example.com",
                    role: "ecologist"
                }
            }
        };

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('assessments', JSON.stringify(db.assessments));
                localStorage.setItem('species', JSON.stringify(db.species));
                localStorage.setItem('activities', JSON.stringify(db.activities));
                localStorage.setItem('monitoring', JSON.stringify(db.monitoring));
                localStorage.setItem('reports', JSON.stringify(db.reports));
                localStorage.setItem('faunaSightings', JSON.stringify(db.faunaSightings));
                localStorage.setItem('vegetationSurveys', JSON.stringify(db.vegetationSurveys));
                localStorage.setItem('complianceChecklist', JSON.stringify(db.complianceChecklist));
                localStorage.setItem('settings', JSON.stringify(db.settings));
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                showToast('Error', 'Failed to save data. Storage may be full.', 'error');
                return false;
            }
        }

        // Show toast notification
        function showToast(title, message, type = 'success') {
            const toastEl = document.getElementById('liveToast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // Remove previous color classes
            toastEl.classList.remove('text-bg-success', 'text-bg-danger', 'text-bg-warning', 'text-bg-info');
            
            // Add appropriate color class based on type
            switch(type) {
                case 'success':
                    toastEl.classList.add('text-bg-success');
                    break;
                case 'error':
                    toastEl.classList.add('text-bg-danger');
                    break;
                case 'warning':
                    toastEl.classList.add('text-bg-warning');
                    break;
                case 'info':
                    toastEl.classList.add('text-bg-info');
                    break;
                default:
                    toastEl.classList.add('text-bg-success');
            }
            
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize components
            initCharts();
            initMap();
            initCalendar();
            loadDashboard();
            loadAssessments();
            loadSpecies();
            loadActivities();
            loadMonitoring();
            loadReports();
            loadComplianceChecklist();
            loadSettings();
            
            // Set up event listeners
            setupEventListeners();
        });

        // Initialize charts
        function initCharts() {
            // Health Indicators Chart
            const healthCtx = document.getElementById('healthChart');
            if (healthCtx) {
                window.healthChart = new Chart(healthCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Biodiversity', 'Native Cover', 'Weed Cover', 'Erosion', 'Fauna', 'Water Quality'],
                        datasets: [{
                            label: 'Current',
                            data: [78, 65, 22, 15, 70, 85],
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Previous',
                            data: [72, 60, 28, 18, 65, 80],
                            backgroundColor: 'rgba(108, 117, 125, 0.2)',
                            borderColor: 'rgba(108, 117, 125, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
            }

            // Fauna Monitoring Chart
            const faunaCtx = document.getElementById('faunaChart');
            if (faunaCtx) {
                window.faunaChart = new Chart(faunaCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Koala',
                            data: [2, 3, 1, 4, 3, 2],
                            borderColor: 'rgba(220, 53, 69, 1)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.1,
                            fill: true
                        }, {
                            label: 'Bush Stone-curlew',
                            data: [5, 4, 6, 3, 5, 7],
                            borderColor: 'rgba(255, 193, 7, 1)',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Threatened Species Sightings'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Vegetation Monitoring Chart
            const vegetationCtx = document.getElementById('vegetationChart');
            if (vegetationCtx) {
                window.vegetationChart = new Chart(vegetationCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Zone 1', 'Zone 2', 'Zone 3', 'Zone 4'],
                        datasets: [{
                            label: 'Native Cover (%)',
                            data: [75, 60, 45, 80],
                            backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        }, {
                            label: 'Weed Cover (%)',
                            data: [15, 25, 40, 10],
                            backgroundColor: 'rgba(220, 53, 69, 0.7)',
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Vegetation Cover by Zone'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }

        // Initialize map
        function initMap() {
            const mapElement = document.getElementById('map');
            if (!mapElement) return;
            
            try {
                // Initialize the map
                window.map = L.map('map').setView([-33.4000, 150.3000], 13); // Blue Mountains coordinates and zoom level

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(window.map);

                // Add a marker for the default location
                const marker = L.marker([-33.4000, 150.3000]).addTo(window.map)
                    .bindPopup('Blue Mountains Conservation Area')
                    .openPopup();

                // Add some sample zones (polygons)
                const zone1 = L.polygon([
                    [-33.41, 150.29],
                    [-33.41, 150.31],
                    [-33.39, 150.31],
                    [-33.39, 150.29]
                ], {color: 'blue', fillOpacity: 0.2}).addTo(window.map).bindPopup('Zone 1 - Native Forest');

                const zone2 = L.polygon([
                    [-33.42, 150.305],
                    [-33.42, 150.315],
                    [-33.40, 150.315],
                    [-33.40, 150.305]
                ], {color: 'green', fillOpacity: 0.2}).addTo(window.map).bindPopup('Zone 2 - Wetland Area');

                const zone3 = L.polygon([
                    [-33.38, 150.295],
                    [-33.38, 150.305],
                    [-33.36, 150.305],
                    [-33.36, 150.295]
                ], {color: 'red', fillOpacity: 0.2}).addTo(window.map).bindPopup('Zone 3 - Weed Control Area');

                // Create layer groups for different map features
                window.zonesLayer = L.layerGroup([zone1, zone2, zone3]);
                window.vegetationLayer = L.layerGroup();
                window.weedsLayer = L.layerGroup();

                // Add some sample vegetation points
                L.marker([-33.405, 150.302]).addTo(window.vegetationLayer)
                    .bindPopup('Eucalyptus pauciflora (Snow Gum)');
                L.marker([-33.404, 150.304]).addTo(window.vegetationLayer)
                    .bindPopup('Acacia melanoxylon (Blackwood)');
                L.marker([-33.406, 150.301]).addTo(window.vegetationLayer)
                    .bindPopup('Banksia marginata (Silver Banksia)');

                // Add some sample weed points
                L.marker([-33.365, 150.301]).addTo(window.weedsLayer)
                    .bindPopup('Rubus fruticosus (Blackberry)');
                L.marker([-33.364, 150.303]).addTo(window.weedsLayer)
                    .bindPopup('Lantana camara (Lantana)');
                L.marker([-33.366, 150.302]).addTo(window.weedsLayer)
                    .bindPopup('Ulex europaeus (Gorse)');

                // Add layer control
                const baseLayers = {
                    "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }),
                    "Satellite": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                    })
                };

                const overlays = {
                    "Zones": window.zonesLayer,
                    "Vegetation": window.vegetationLayer,
                    "Weeds": window.weedsLayer
                };

                L.control.layers(baseLayers, overlays, {collapsed: false}).addTo(window.map);

                // Default to showing zones
                window.zonesLayer.addTo(window.map);

                // Button controls for map layers
                document.getElementById('zoneToggle').addEventListener('click', function() {
                    if (window.map.hasLayer(window.zonesLayer)) {
                        window.map.removeLayer(window.zonesLayer);
                        this.classList.remove('active');
                    } else {
                        window.map.addLayer(window.zonesLayer);
                        this.classList.add('active');
                    }
                });

                document.getElementById('vegetationToggle').addEventListener('click', function() {
                    if (window.map.hasLayer(window.vegetationLayer)) {
                        window.map.removeLayer(window.vegetationLayer);
                        this.classList.remove('active');
                    } else {
                        window.map.addLayer(window.vegetationLayer);
                        this.classList.add('active');
                    }
                });

                document.getElementById('weedsToggle').addEventListener('click', function() {
                    if (window.map.hasLayer(window.weedsLayer)) {
                        window.map.removeLayer(window.weedsLayer);
                        this.classList.remove('active');
                    } else {
                        window.map.addLayer(window.weedsLayer);
                        this.classList.add('active');
                    }
                });
            } catch (error) {
                console.error('Error initializing map:', error);
                document.getElementById('map').innerHTML = '<div class="alert alert-warning">Map could not be loaded. Please check your internet connection.</div>';
            }
        }

        // Initialize calendar
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) return;
            
            try {
                window.calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: db.activities.map(activity => ({
                        title: activity.title,
                        start: activity.startDate,
                        end: activity.endDate || activity.startDate,
                        extendedProps: {
                            type: activity.type,
                            location: activity.location,
                            assignedTo: activity.assignedTo,
                            status: activity.status
                        },
                        backgroundColor: getActivityColor(activity.type),
                        borderColor: getActivityColor(activity.type),
                        textColor: '#fff'
                    })),
                    eventClick: function(info) {
                        const activity = db.activities.find(a => a.title === info.event.title && a.startDate === info.event.startStr);
                        if (activity) {
                            showActivityDetails(activity);
                        }
                    },
                    eventContent: function(arg) {
                        // Customize event display to show type and location
                        const type = arg.event.extendedProps.type;
                        const location = arg.event.extendedProps.location;
                        
                        const eventEl = document.createElement('div');
                        eventEl.className = 'fc-event-main-frame';
                        
                        const titleEl = document.createElement('div');
                        titleEl.className = 'fc-event-title';
                        titleEl.innerHTML = `<strong>${arg.event.title}</strong><br>${formatActivityType(type)} - ${location}`;
                        
                        eventEl.appendChild(titleEl);
                        
                        return { domNodes: [eventEl] };
                    }
                });
                window.calendar.render();
            } catch (error) {
                console.error('Error initializing calendar:', error);
                calendarEl.innerHTML = '<div class="alert alert-warning">Calendar could not be loaded.</div>';
            }
        }

        // Get color for activity type
        function getActivityColor(type) {
            switch(type) {
                case 'weed-control': return '#dc3545';
                case 'revegetation': return '#28a745';
                case 'erosion-control': return '#fd7e14';
                case 'fauna-survey': return '#17a2b8';
                case 'vegetation-survey': return '#20c997';
                case 'water-quality': return '#007bff';
                default: return '#6c757d';
            }
        }

        // Load dashboard data
        function loadDashboard() {
            // Update dashboard stats
            const upcomingTasks = db.activities.filter(a => a.status !== 'completed' && a.status !== 'cancelled');
            document.getElementById('totalTasks').textContent = upcomingTasks.length;
            document.getElementById('totalAssessments').textContent = db.assessments.length;
            document.getElementById('totalSpecies').textContent = db.species.length;
            
            const completedItems = db.complianceChecklist.filter(item => item.compliant === 'Yes').length;
            const totalItems = db.complianceChecklist.length;
            const progressPercentage = Math.round((completedItems / totalItems) * 100);
            document.getElementById('compliancePercent').textContent = `${progressPercentage}%`;
            
            // Upcoming tasks
            const upcomingTasksList = document.getElementById('upcomingTasksList');
            if (upcomingTasksList) {
                upcomingTasksList.innerHTML = '';
                
                if (upcomingTasks.length === 0) {
                    upcomingTasksList.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-check-circle"></i>
                            <p>No upcoming tasks</p>
                        </div>
                    `;
                } else {
                    upcomingTasks
                        .sort((a, b) => new Date(a.startDate) - new Date(b.startDate))
                        .slice(0, 5)
                        .forEach(task => {
                        const taskEl = document.createElement('a');
                        taskEl.href = '#';
                        taskEl.className = 'list-group-item list-group-item-action';
                        taskEl.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${task.title}</h6>
                                <small class="text-muted">${formatDate(task.startDate)}</small>
                            </div>
                            <p class="mb-1">${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</p>
                            <small class="text-muted">Assigned to: ${task.assignedTo}</small>
                        `;
                        taskEl.addEventListener('click', () => showActivityDetails(task));
                        upcomingTasksList.appendChild(taskEl);
                    });
                }
            }
            
            // Recent observations
            const recentObservations = db.monitoring
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 4);
            
            const recentObservationsList = document.getElementById('recentObservationsList');
            if (recentObservationsList) {
                recentObservationsList.innerHTML = '';
                
                if (recentObservations.length === 0) {
                    recentObservationsList.innerHTML = `
                        <li class="list-group-item empty-state">
                            <i class="bi bi-binoculars"></i>
                            <p>No recent observations</p>
                        </li>
                    `;
                } else {
                    recentObservations.forEach(obs => {
                        const obsEl = document.createElement('li');
                        obsEl.className = 'list-group-item d-flex justify-content-between align-items-center';
                        obsEl.innerHTML = `
                            ${obs.type === 'fauna-survey' ? 'Fauna sighting' : 'Vegetation survey'}
                            <span class="badge ${getStatusBadgeClass(obs.type === 'fauna-survey' ? 'info' : 'success')} rounded-pill">
                                ${obs.type === 'fauna-survey' ? 'Fauna' : 'Flora'}
                            </span>
                        `;
                        obsEl.addEventListener('click', () => showMonitoringDetails(obs));
                        recentObservationsList.appendChild(obsEl);
                    });
                }
            }
            
            // Compliance checklist
            const complianceChecklist = document.getElementById('complianceChecklist');
            if (complianceChecklist) {
                complianceChecklist.innerHTML = '';
                
                document.getElementById('complianceProgress').style.width = `${progressPercentage}%`;
                document.getElementById('complianceProgress').textContent = `${progressPercentage}% Complete`;
                document.getElementById('complianceProgress').setAttribute('aria-valuenow', progressPercentage);
                
                db.complianceChecklist.forEach(item => {
                    const checkEl = document.createElement('div');
                    checkEl.className = 'form-check mb-2';
                    checkEl.innerHTML = `
                        <input class="form-check-input" type="checkbox" id="check${item.id}" ${item.compliant === 'Yes' ? 'checked' : ''}>
                        <label class="form-check-label" for="check${item.id}">
                            ${item.requirement}
                        </label>
                    `;
                    complianceChecklist.appendChild(checkEl);
                });
            }
        }

        // Load assessments
        function loadAssessments() {
            const assessmentsTable = document.getElementById('assessmentsTable');
            if (!assessmentsTable) return;
            
            const tbody = assessmentsTable.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            if (db.assessments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="empty-state">
                                <i class="bi bi-clipboard-data"></i>
                                <p>No assessments recorded yet</p>
                                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#newAssessmentModal">Create First Assessment</button>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                db.assessments.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(assessment => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${formatDate(assessment.date)}</td>
                        <td>${assessment.assessor}</td>
                        <td><span class="badge ${getHealthBadgeClass(assessment.health)}">${capitalizeFirstLetter(assessment.health)}</span></td>
                        <td>${assessment.threats.join(', ') || 'None'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary view-assessment" data-id="${assessment.id}">View</button>
                                <button class="btn btn-sm btn-outline-secondary export-assessment" data-id="${assessment.id}">PDF</button>
                            </div>
                        </td>
                    `;
                });
            }
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-assessment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const assessmentId = this.getAttribute('data-id');
                    const assessment = db.assessments.find(a => a.id == assessmentId);
                    if (assessment) {
                        showAssessmentDetails(assessment);
                    }
                });
            });
        }

        // Load species
        function loadSpecies() {
            // Species cards
            const speciesCardsContainer = document.getElementById('speciesCardsContainer');
            if (speciesCardsContainer) {
                speciesCardsContainer.innerHTML = '';
                
                const recentSpecies = db.species
                    .sort((a, b) => new Date(b.lastObserved || 0) - new Date(a.lastObserved || 0))
                    .slice(0, 3);
                
                if (recentSpecies.length === 0) {
                    speciesCardsContainer.innerHTML = `
                        <div class="col-12">
                            <div class="empty-state">
                                <i class="bi bi-tree"></i>
                                <p>No species recorded yet</p>
                                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#newSpeciesModal">Add First Species</button>
                            </div>
                        </div>
                    `;
                } else {
                    recentSpecies.forEach(species => {
                        const cardCol = document.createElement('div');
                        cardCol.className = 'col-md-4 mb-4';
                        cardCol.innerHTML = `
                            <div class="card h-100 species-card">
                                <img src="${species.image || 'https://via.placeholder.com/300x200?text=No+image'}" class="card-img-top" alt="${species.scientificName}" style="height: 200px; object-fit: cover;">
                                <div class="card-body">
                                    <h5 class="card-title">${species.scientificName}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${species.commonName || 'No common name'}</h6>
                                    <p class="card-text">
                                        <span class="badge ${getSpeciesStatusBadgeClass(species.status)} me-1">${capitalizeFirstLetter(species.status)}</span>
                                        ${species.type === 'weed' || species.type === 'pest' ? `<span class="badge bg-warning">High priority</span>` : ''}
                                    </p>
                                    <p class="card-text"><small>Last observed: ${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</small></p>
                                    <button class="btn btn-sm btn-outline-primary view-species" data-id="${species.id}">View Details</button>
                                </div>
                            </div>
                        `;
                        speciesCardsContainer.appendChild(cardCol);
                    });
                }
            }
            
            // Species table
            const speciesTable = document.getElementById('speciesTable');
            if (!speciesTable) return;
            
            const tbody = speciesTable.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            if (db.species.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <i class="bi bi-tree"></i>
                                <p>No species recorded yet</p>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                // Populate monitoring species dropdown
                const monitoringSpeciesSelect = document.getElementById('monitoringSpecies');
                const faunaSpeciesSelect = document.getElementById('faunaSpecies');
                const vegetationSpeciesSelect = document.getElementById('vegetationSpecies');
                
                if (monitoringSpeciesSelect) monitoringSpeciesSelect.innerHTML = '';
                if (faunaSpeciesSelect) faunaSpeciesSelect.innerHTML = '<option value="" selected disabled>Select species...</option>';
                if (vegetationSpeciesSelect) vegetationSpeciesSelect.innerHTML = '';
                
                db.species.forEach(species => {
                    // Add to table
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${species.scientificName}</td>
                        <td>${species.commonName || '-'}</td>
                        <td>${capitalizeFirstLetter(species.type)}</td>
                        <td><span class="badge ${getSpeciesStatusBadgeClass(species.status)}">${capitalizeFirstLetter(species.status)}</span></td>
                        <td>${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary view-species" data-id="${species.id}">View</button>
                                ${species.type === 'flora' && species.status === 'weed' ? 
                                    '<button class="btn btn-sm btn-outline-warning control-species" data-id="${species.id}">Control</button>' : 
                                    (species.type === 'fauna' && (species.status === 'endangered' || species.status === 'vulnerable') ? 
                                        '<button class="btn btn-sm btn-outline-info monitor-species" data-id="${species.id}">Monitor</button>' : 
                                        '<button class="btn btn-sm btn-outline-secondary map-species" data-id="${species.id}">Map</button>')}
                            </div>
                        </td>
                    `;
                    
                    // Add to monitoring species dropdown
                    if (monitoringSpeciesSelect) {
                        const option = document.createElement('option');
                        option.value = species.id;
                        option.textContent = `${species.scientificName}${species.commonName ? ` (${species.commonName})` : ''}`;
                        monitoringSpeciesSelect.appendChild(option);
                    }
                    
                    // Add to fauna species dropdown
                    if (faunaSpeciesSelect && species.type === 'fauna') {
                        const option = document.createElement('option');
                        option.value = species.id;
                        option.textContent = `${species.scientificName}${species.commonName ? ` (${species.commonName})` : ''}`;
                        faunaSpeciesSelect.appendChild(option);
                    }
                    
                    // Add to vegetation species dropdown
                    if (vegetationSpeciesSelect && species.type === 'flora') {
                        const option = document.createElement('option');
                        option.value = species.id;
                        option.textContent = `${species.scientificName}${species.commonName ? ` (${species.commonName})` : ''}`;
                        vegetationSpeciesSelect.appendChild(option);
                    }
                });
            }
            
            // Add event listeners to species buttons
            document.querySelectorAll('.view-species').forEach(btn => {
                btn.addEventListener('click', function() {
                    const speciesId = this.getAttribute('data-id');
                    const species = db.species.find(s => s.id == speciesId);
                    if (species) {
                        showSpeciesDetails(species);
                    }
                });
            });
        }

        // Load activities
        function loadActivities() {
            // Upcoming activities
            const upcomingTable = document.getElementById('upcomingActivitiesTable');
            if (upcomingTable) {
                const tbody = upcomingTable.getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                
                const upcomingActivities = db.activities
                    .filter(a => a.status === 'planned' || a.status === 'in-progress')
                    .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                
                if (upcomingActivities.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">
                                <div class="empty-state">
                                    <i class="bi bi-calendar-check"></i>
                                    <p>No upcoming activities</p>
                                    <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#newActivityModal">Schedule First Activity</button>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    upcomingActivities.forEach(activity => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${activity.title}</td>
                            <td>${formatActivityType(activity.type)}</td>
                            <td>${formatDate(activity.startDate)}</td>
                            <td>${activity.location}</td>
                            <td>${activity.assignedTo}</td>
                            <td><span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                                </div>
                            </td>
                        `;
                    });
                }
            }
            
            // Completed activities
            const completedTable = document.getElementById('completedActivitiesTable');
            if (completedTable) {
                const tbody = completedTable.getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                
                const completedActivities = db.activities
                    .filter(a => a.status === 'completed')
                    .sort((a, b) => new Date(b.endDate || b.startDate) - new Date(a.endDate || a.startDate));
                
                if (completedActivities.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">
                                <div class="empty-state">
                                    <i class="bi bi-check-circle"></i>
                                    <p>No completed activities</p>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    completedActivities.forEach(activity => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${activity.title}</td>
                            <td>${formatActivityType(activity.type)}</td>
                            <td>${formatDate(activity.endDate || activity.startDate)}</td>
                            <td>${activity.location}</td>
                            <td>${activity.assignedTo}</td>
                            <td><span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                                    <button class="btn btn-sm btn-outline-secondary report-activity" data-id="${activity.id}">Report</button>
                                </div>
                            </td>
                        `;
                    });
                }
            }
            
            // Overdue activities
            const overdueTable = document.getElementById('overdueActivitiesTable');
            if (overdueTable) {
                const tbody = overdueTable.getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const overdueActivities = db.activities
                    .filter(a => (a.status === 'planned' || a.status === 'in-progress') && new Date(a.startDate) < today)
                    .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                
                if (overdueActivities.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center">
                                <div class="empty-state">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    <p>No overdue activities</p>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    overdueActivities.forEach(activity => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${activity.title}</td>
                            <td>${formatActivityType(activity.type)}</td>
                            <td>${formatDate(activity.startDate)}</td>
                            <td>${activity.location}</td>
                            <td>${activity.assignedTo}</td>
                            <td><span class="badge bg-danger">Overdue</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                                    <button class="btn btn-sm btn-warning reschedule-activity" data-id="${activity.id}">Reschedule</button>
                                </div>
                            </td>
                        `;
                    });
                }
            }
            
            // Add event listeners to activity buttons
            document.querySelectorAll('.view-activity').forEach(btn => {
                btn.addEventListener('click', function() {
                    const activityId = this.getAttribute('data-id');
                    const activity = db.activities.find(a => a.id == activityId);
                    if (activity) {
                        showActivityDetails(activity);
                    }
                });
            });
        }

        // Load monitoring
        function loadMonitoring() {
            const monitoringTable = document.getElementById('monitoringTable');
            if (!monitoringTable) return;
            
            const tbody = monitoringTable.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            if (db.monitoring.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="empty-state">
                                <i class="bi bi-binoculars"></i>
                                <p>No monitoring activities recorded yet</p>
                                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#newMonitoringModal">Add First Monitoring</button>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                db.monitoring.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(monitoring => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${formatDate(monitoring.date)}</td>
                        <td>${formatMonitoringType(monitoring.type)}</td>
                        <td>${monitoring.location}</td>
                        <td>${monitoring.observer}</td>
                        <td>${monitoring.findings.substring(0, 50)}${monitoring.findings.length > 50 ? '...' : ''}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary view-monitoring" data-id="${monitoring.id}">View</button>
                                <button class="btn btn-sm btn-outline-secondary report-monitoring" data-id="${monitoring.id}">Report</button>
                                ${monitoring.type === 'weed-mapping' ? 
                                    '<button class="btn btn-sm btn-outline-warning control-monitoring" data-id="${monitoring.id}">Control</button>' : ''}
                            </div>
                        </td>
                    `;
                });
            }
            
            // Add event listeners to monitoring buttons
            document.querySelectorAll('.view-monitoring').forEach(btn => {
                btn.addEventListener('click', function() {
                    const monitoringId = this.getAttribute('data-id');
                    const monitoring = db.monitoring.find(m => m.id == monitoringId);
                    if (monitoring) {
                        showMonitoringDetails(monitoring);
                    }
                });
            });
        }

        // Load reports
        function loadReports() {
            const reportsTable = document.getElementById('reportsTable');
            if (!reportsTable) return;
            
            const tbody = reportsTable.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            if (db.reports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="empty-state">
                                <i class="bi bi-file-earmark-text"></i>
                                <p>No reports generated yet</p>
                                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#generateReportModal">Generate First Report</button>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                db.reports.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(report => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${formatDate(report.date)}</td>
                        <td>${formatReportType(report.type)}</td>
                        <td>${report.generatedBy}</td>
                        <td>${report.period || 'N/A'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary view-report" data-id="${report.id}">View</button>
                                <button class="btn btn-sm btn-outline-secondary download-report" data-id="${report.id}">PDF</button>
                            </div>
                        </td>
                    `;
                });
            }
            
            // Add event listeners to report buttons
            document.querySelectorAll('.view-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.getAttribute('data-id');
                    const report = db.reports.find(r => r.id == reportId);
                    if (report) {
                        showReportDetails(report);
                    }
                });
            });
        }

        // Load compliance checklist
        function loadComplianceChecklist() {
            const complianceTable = document.getElementById('complianceChecklistTable');
            if (!complianceTable) return;
            
            const tbody = complianceTable.getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';
            
            db.complianceChecklist.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.requirement}</td>
                    <td>
                        <select class="form-select form-select-sm compliance-status" data-id="${item.id}">
                            <option value="" ${item.compliant === '' ? 'selected' : ''}>Select...</option>
                            <option value="Yes" ${item.compliant === 'Yes' ? 'selected' : ''}>Yes</option>
                            <option value="No" ${item.compliant === 'No' ? 'selected' : ''}>No</option>
                            <option value="Partial" ${item.compliant === 'Partial' ? 'selected' : ''}>Partial</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" class="form-control form-control-sm compliance-evidence" data-id="${item.id}" value="${item.evidence || ''}" placeholder="Document reference">
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary compliance-note" data-id="${item.id}">Add Note</button>
                    </td>
                `;
            });
        }

        // Load settings
        function loadSettings() {
            const settings = db.settings;
            
            // User profile
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const userRole = document.getElementById('userRole');
            
            if (userName) userName.value = settings.userProfile.name || '';
            if (userEmail) userEmail.value = settings.userProfile.email || '';
            if (userRole) userRole.value = settings.userProfile.role || '';
            
            // Site settings
            const siteName = document.getElementById('siteName');
            const siteLocation = document.getElementById('siteLocation');
            const siteArea = document.getElementById('siteArea');
            const siteDescription = document.getElementById('siteDescription');
            
            if (siteName) siteName.value = settings.siteName || '';
            if (siteLocation) siteLocation.value = settings.siteLocation || '';
            if (siteArea) siteArea.value = settings.siteArea || '';
            if (siteDescription) siteDescription.value = settings.siteDescription || '';
        }

        // Set up event listeners
        function setupEventListeners() {
            // Assessment form submission
            document.getElementById('saveAssessment')?.addEventListener('click', function() {
                saveAssessment();
            });
            
            // Activity form submission
            document.getElementById('saveActivity')?.addEventListener('click', function() {
                saveActivity();
            });
            
            // Species form submission
            document.getElementById('saveSpecies')?.addEventListener('click', function() {
                saveSpecies();
            });
            
            // Monitoring form submission
            document.getElementById('saveMonitoring')?.addEventListener('click', function() {
                saveMonitoring();
            });
            
            // Fauna sighting form submission
            document.getElementById('saveFaunaSighting')?.addEventListener('click', function() {
                saveFaunaSighting();
            });
            
            // Vegetation survey form submission
            document.getElementById('saveVegetationSurvey')?.addEventListener('click', function() {
                saveVegetationSurvey();
            });
            
            // Compliance checklist save
            document.getElementById('saveComplianceChecklist')?.addEventListener('click', function() {
                saveComplianceChecklist();
            });
            
            // User profile form submission
            document.getElementById('userProfileForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveUserProfile();
            });
            
            // Change password form submission
            document.getElementById('changePasswordForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                changePassword();
            });
            
            // Site settings form submission
            document.getElementById('siteSettingsForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveSiteSettings();
            });
            
            // Data management buttons
            document.getElementById('exportAllData')?.addEventListener('click', function() {
                exportAllData();
            });
            
            document.getElementById('backupDatabase')?.addEventListener('click', function() {
                backupDatabase();
            });
            
            document.getElementById('resetTestData')?.addEventListener('click', function() {
                showConfirmation('Reset Test Data', 'Are you sure you want to reset all test data? This cannot be undone.', resetTestData);
            });
            
            // Generate compliance report
            document.getElementById('generateComplianceReport')?.addEventListener('click', function() {
                generateComplianceReport();
            });
            
            // Generate report button
            document.getElementById('generateReportBtn')?.addEventListener('click', function() {
                generateReportFromModal();
            });
            
            // Species image preview
            document.getElementById('speciesImage')?.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('speciesImagePreview');
                        if (preview) {
                            preview.src = event.target.result;
                            preview.style.display = 'block';
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Assessment photo preview
            document.getElementById('assessmentPhotos')?.addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('assessmentPhotoPreview');
                if (previewContainer) {
                    previewContainer.innerHTML = '';
                    
                    if (files.length > 0) {
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.type.match('image.*')) {
                                const reader = new FileReader();
                                reader.onload = function(event) {
                                    const img = document.createElement('img');
                                    img.src = event.target.result;
                                    img.className = 'image-thumbnail';
                                    previewContainer.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        }
                    }
                }
            });
            
            // Monitoring photo preview
            document.getElementById('monitoringPhotos')?.addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('monitoringPhotoPreview');
                if (previewContainer) {
                    previewContainer.innerHTML = '';
                    
                    if (files.length > 0) {
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.type.match('image.*')) {
                                const reader = new FileReader();
                                reader.onload = function(event) {
                                    const img = document.createElement('img');
                                    img.src = event.target.result;
                                    img.className = 'image-thumbnail';
                                    previewContainer.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        }
                    }
                }
            });
            
            // Fauna photo preview
            document.getElementById('faunaPhotos')?.addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('faunaPhotoPreview');
                if (previewContainer) {
                    previewContainer.innerHTML = '';
                    
                    if (files.length > 0) {
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.type.match('image.*')) {
                                const reader = new FileReader();
                                reader.onload = function(event) {
                                    const img = document.createElement('img');
                                    img.src = event.target.result;
                                    img.className = 'image-thumbnail';
                                    previewContainer.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        }
                    }
                }
            });
            
            // Vegetation photo preview
            document.getElementById('vegetationPhotos')?.addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('vegetationPhotoPreview');
                if (previewContainer) {
                    previewContainer.innerHTML = '';
                    
                    if (files.length > 0) {
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.type.match('image.*')) {
                                const reader = new FileReader();
                                reader.onload = function(event) {
                                    const img = document.createElement('img');
                                    img.src = event.target.result;
                                    img.className = 'image-thumbnail';
                                    previewContainer.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        }
                    }
                }
            });
            
            // Tab change events to refresh data
            const tabLinks = document.querySelectorAll('.nav-link[data-bs-toggle="tab"]');
            tabLinks.forEach(link => {
                link.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('href');
                    if (target === '#dashboard') {
                        loadDashboard();
                    } else if (target === '#site-assessment') {
                        loadAssessments();
                    } else if (target === '#maintenance-plan') {
                        loadActivities();
                        if (window.calendar) {
                            window.calendar.refetchEvents();
                        }
                    } else if (target === '#species-register') {
                        loadSpecies();
                    } else if (target === '#monitoring') {
                        loadMonitoring();
                    } else if (target === '#reports') {
                        loadReports();
                    } else if (target === '#legislation') {
                        loadComplianceChecklist();
                    } else if (target === '#settings') {
                        loadSettings();
                    }
                });
            });
            
            // Validate components selection
            const componentCheckboxes = document.querySelectorAll('input[name="components"]');
            componentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    validateComponents();
                });
            });
            
            // Export and print buttons
            document.getElementById('exportDashboard')?.addEventListener('click', function() {
                exportDashboard();
            });
            
            document.getElementById('printDashboard')?.addEventListener('click', function() {
                printDashboard();
            });
            
            document.getElementById('exportSpecies')?.addEventListener('click', function() {
                exportSpecies();
            });
            
            document.getElementById('printSpecies')?.addEventListener('click', function() {
                printSpecies();
            });
            
            document.getElementById('viewAllFauna')?.addEventListener('click', function() {
                viewAllFauna();
            });
            
            document.getElementById('viewAllVegetation')?.addEventListener('click', function() {
                viewAllVegetation();
            });
        }

        // Save assessment
        function saveAssessment() {
            const form = document.getElementById('newAssessmentForm');
            if (!form || !form.checkValidity()) {
                if (form) form.classList.add('was-validated');
                validateComponents();
                return;
            }
            
            const selectedComponents = Array.from(document.querySelectorAll('input[name="components"]:checked')).map(cb => cb.value);
            if (selectedComponents.length === 0) {
                const componentsFeedback = document.getElementById('componentsFeedback');
                if (componentsFeedback) componentsFeedback.style.display = 'block';
                return;
            }
            
            const threats = Array.from(document.getElementById('threats').selectedOptions).map(opt => opt.value);
            
            const newAssessment = {
                id: Date.now(),
                date: document.getElementById('assessmentDate').value,
                assessor: document.getElementById('assessorName').value,
                description: document.getElementById('siteDescription').value,
                components: selectedComponents,
                health: document.getElementById('ecosystemHealth').value,
                threats: threats,
                photos: [], // Would be handled with file upload in a real app
                createdAt: new Date().toISOString()
            };
            
            db.assessments.push(newAssessment);
            if (saveData()) {
                // Reset form
                form.reset();
                form.classList.remove('was-validated');
                const assessmentPhotoPreview = document.getElementById('assessmentPhotoPreview');
                if (assessmentPhotoPreview) assessmentPhotoPreview.innerHTML = '';
                
                // Show success message
                showToast('Success', 'Assessment saved successfully!');
                
                // Reload assessments
                loadAssessments();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newAssessmentModal'));
                if (modal) modal.hide();
            }
        }

        // Save activity
        function saveActivity() {
            const form = document.getElementById('activityForm');
            const fields = ['activityType', 'activityTitle', 'activityStartDate', 'activityLocation', 'activityDescription', 'activityAssignedTo'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    if (element) element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            const newActivity = {
                id: Date.now(),
                type: document.getElementById('activityType').value,
                title: document.getElementById('activityTitle').value,
                startDate: document.getElementById('activityStartDate').value,
                endDate: document.getElementById('activityEndDate').value || null,
                location: document.getElementById('activityLocation').value,
                description: document.getElementById('activityDescription').value,
                assignedTo: document.getElementById('activityAssignedTo').value,
                priority: document.getElementById('activityPriority').value,
                status: document.getElementById('activityStatus').value,
                notes: document.getElementById('activityNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.activities.push(newActivity);
            if (saveData()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newActivityModal'));
                if (modal) modal.hide();
                
                // Show success message
                showToast('Success', 'Activity saved successfully!');
                
                // Reload activities
                loadActivities();
                if (window.calendar) {
                    window.calendar.refetchEvents();
                }
            }
        }

        // Save species
        function saveSpecies() {
            const form = document.getElementById('speciesForm');
            const fields = ['speciesScientificName', 'speciesType', 'speciesStatus'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    if (element) element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    if (element) element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle image upload (simplified for demo)
            let image = '';
            const fileInput = document.getElementById('speciesImage');
            if (fileInput && fileInput.files.length > 0) {
                image = URL.createObjectURL(fileInput.files[0]);
            }
            
            const newSpecies = {
                id: Date.now(),
                scientificName: document.getElementById('speciesScientificName').value,
                commonName: document.getElementById('speciesCommonName').value || null,
                type: document.getElementById('speciesType').value,
                status: document.getElementById('speciesStatus').value,
                description: document.getElementById('speciesDescription').value,
                habitat: document.getElementById('speciesHabitat').value || null,
                lastObserved: document.getElementById('speciesLastObserved').value || null,
                image: image,
                notes: document.getElementById('speciesNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.species.push(newSpecies);
            if (saveData()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newSpeciesModal'));
                if (modal) modal.hide();
                
                // Show success message
                showToast('Success', 'Species record saved successfully!');
                
                // Reload species
                loadSpecies();
            }
        }

        // Save monitoring
        function saveMonitoring() {
            const form = document.getElementById('monitoringForm');
            const fields = ['monitoringType', 'monitoringDate', 'monitoringLocation', 'monitoringObserver', 'monitoringFindings'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    if (element) element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    if (element) element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle species selection
            const selectedSpecies = Array.from(document.getElementById('monitoringSpecies').selectedOptions).map(opt => opt.value);
            
            // Handle photo upload (simplified for demo)
            const photos = [];
            const fileInput = document.getElementById('monitoringPhotos');
            if (fileInput && fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    if (fileInput.files[i].type.match('image.*')) {
                        photos.push(URL.createObjectURL(fileInput.files[i]));
                    }
                }
            }
            
            const newMonitoring = {
                id: Date.now(),
                type: document.getElementById('monitoringType').value,
                date: document.getElementById('monitoringDate').value,
                location: document.getElementById('monitoringLocation').value,
                observer: document.getElementById('monitoringObserver').value,
                findings: document.getElementById('monitoringFindings').value,
                species: selectedSpecies,
                photos: photos,
                notes: document.getElementById('monitoringNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.monitoring.push(newMonitoring);
            if (saveData()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newMonitoringModal'));
                if (modal) modal.hide();
                
                // Show success message
                showToast('Success', 'Monitoring record saved successfully!');
                
                // Reload monitoring
                loadMonitoring();
            }
        }

        // Save fauna sighting
        function saveFaunaSighting() {
            const form = document.getElementById('faunaSightingForm');
            const fields = ['faunaSpecies', 'faunaDate', 'faunaLocation', 'faunaObserver'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    if (element) element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    if (element) element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle photo upload (simplified for demo)
            const photos = [];
            const fileInput = document.getElementById('faunaPhotos');
            if (fileInput && fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    if (fileInput.files[i].type.match('image.*')) {
                        photos.push(URL.createObjectURL(fileInput.files[i]));
                    }
                }
            }
            
            const newSighting = {
                id: Date.now(),
                speciesId: parseInt(document.getElementById('faunaSpecies').value),
                date: document.getElementById('faunaDate').value,
                location: document.getElementById('faunaLocation').value,
                observer: document.getElementById('faunaObserver').value,
                count: parseInt(document.getElementById('faunaCount').value) || 1,
                behavior: document.getElementById('faunaBehavior').value,
                photos: photos,
                notes: document.getElementById('faunaNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.faunaSightings.push(newSighting);
            
            // Update species last observed date
            const species = db.species.find(s => s.id == newSighting.speciesId);
            if (species) {
                species.lastObserved = newSighting.date;
            }
            
            if (saveData()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newFaunaSightingModal'));
                if (modal) modal.hide();
                
                // Show success message
                showToast('Success', 'Fauna sighting saved successfully!');
                
                // Reload species and monitoring
                loadSpecies();
                loadMonitoring();
            }
        }

        // Save vegetation survey
        function saveVegetationSurvey() {
            const form = document.getElementById('vegetationSurveyForm');
            const fields = ['vegetationDate', 'vegetationLocation', 'vegetationObserver', 'vegetationFindings'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    if (element) element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    if (element) element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle species selection
            const selectedSpecies = Array.from(document.getElementById('vegetationSpecies').selectedOptions).map(opt => opt.value);
            
            // Handle photo upload (simplified for demo)
            const photos = [];
            const fileInput = document.getElementById('vegetationPhotos');
            if (fileInput && fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    if (fileInput.files[i].type.match('image.*')) {
                        photos.push(URL.createObjectURL(fileInput.files[i]));
                    }
                }
            }
            
            const newSurvey = {
                id: Date.now(),
                date: document.getElementById('vegetationDate').value,
                location: document.getElementById('vegetationLocation').value,
                observer: document.getElementById('vegetationObserver').value,
                species: selectedSpecies,
                nativeCover: parseInt(document.getElementById('vegetationCover').value) || 0,
                weedCover: parseInt(document.getElementById('vegetationWeedCover').value) || 0,
                health: document.getElementById('vegetationHealth').value,
                findings: document.getElementById('vegetationFindings').value,
                photos: photos,
                notes: document.getElementById('vegetationNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.vegetationSurveys.push(newSurvey);
            
            // Update species last observed dates
            selectedSpecies.forEach(speciesId => {
                const species = db.species.find(s => s.id == speciesId);
                if (species) {
                    species.lastObserved = newSurvey.date;
                }
            });
            
            if (saveData()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newVegetationSurveyModal'));
                if (modal) modal.hide();
                
                // Show success message
                showToast('Success', 'Vegetation survey saved successfully!');
                
                // Reload species and monitoring
                loadSpecies();
                loadMonitoring();
            }
        }

        // Save compliance checklist
        function saveComplianceChecklist() {
            const statusElements = document.querySelectorAll('.compliance-status');
            const evidenceElements = document.querySelectorAll('.compliance-evidence');
            
            statusElements.forEach(element => {
                const id = parseInt(element.getAttribute('data-id'));
                const item = db.complianceChecklist.find(i => i.id === id);
                if (item) {
                    item.compliant = element.value;
                }
            });
            
            evidenceElements.forEach(element => {
                const id = parseInt(element.getAttribute('data-id'));
                const item = db.complianceChecklist.find(i => i.id === id);
                if (item) {
                    item.evidence = element.value;
                }
            });
            
            if (saveData()) {
                // Show success message
                showToast('Success', 'Compliance checklist saved successfully!');
                
                // Update dashboard
                loadDashboard();
            }
        }

        // Save user profile
        function saveUserProfile() {
            const form = document.getElementById('userProfileForm');
            if (!form || !form.checkValidity()) {
                if (form) form.classList.add('was-validated');
                return;
            }
            
            db.settings.userProfile = {
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value
            };
            
            if (saveData()) {
                // Show success message
                showToast('Success', 'User profile updated successfully!');
            }
        }

        // Change password
        function changePassword() {
            const form = document.getElementById('changePasswordForm');
            if (!form || !form.checkValidity()) {
                if (form) form.classList.add('was-validated');
                return;
            }
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                document.getElementById('confirmPassword').classList.add('is-invalid');
                return;
            }
            
            // In a real app, you would handle password change here
            form.reset();
            form.classList.remove('was-validated');
            
            // Show success message
            showToast('Success', 'Password changed successfully!');
        }

        // Save site settings
        function saveSiteSettings() {
            const form = document.getElementById('siteSettingsForm');
            if (!form || !form.checkValidity()) {
                if (form) form.classList.add('was-validated');
                return;
            }
            
            db.settings = {
                ...db.settings,
                siteName: document.getElementById('siteName').value,
                siteLocation: document.getElementById('siteLocation').value,
                siteArea: parseFloat(document.getElementById('siteArea').value),
                siteDescription: document.getElementById('siteDescription').value
            };
            
            if (saveData()) {
                // Show success message
                showToast('Success', 'Site settings updated successfully!');
            }
        }

        // Export all data
        function exportAllData() {
            const dataStr = JSON.stringify(db, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `ecosystem-maintenance-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Success', 'All data exported successfully!');
        }

        // Backup database
        function backupDatabase() {
            // In a real app, this would send data to a server for backup
            exportAllData(); // For demo, just export the data
            showToast('Info', 'Backup created (data exported)', 'info');
        }

        // Reset test data
        function resetTestData() {
            // Clear all data
            localStorage.clear();
            
            // Reload the page to reset everything
            window.location.reload();
        }

        // Generate compliance report
        function generateComplianceReport() {
            const completedItems = db.complianceChecklist.filter(item => item.compliant === 'Yes').length;
            const totalItems = db.complianceChecklist.length;
            const progressPercentage = Math.round((completedItems / totalItems) * 100);
            
            const newReport = {
                id: Date.now(),
                type: 'compliance',
                date: new Date().toISOString(),
                generatedBy: db.settings.userProfile.name,
                content: {
                    title: 'Compliance Report',
                    body: 'This report shows compliance with AHCECR301 requirements.',
                    progress: progressPercentage,
                    checklist: db.complianceChecklist,
                    summary: `Compliance progress: ${progressPercentage}% complete`
                },
                createdAt: new Date().toISOString()
            };
            
            db.reports.push(newReport);
            if (saveData()) {
                // Show the report
                showReportDetails(newReport);
                
                // Show success message
                showToast('Success', 'Compliance report generated successfully!');
            }
        }

        // Generate report
        function generateReport(type) {
            let reportTitle = '';
            let reportContent = '';
            
            switch(type) {
                case 'compliance':
                    reportTitle = 'Compliance Report';
                    reportContent = 'This report shows compliance with AHCECR301 requirements.';
                    break;
                case 'maintenance':
                    reportTitle = 'Maintenance Summary';
                    reportContent = 'Summary of all maintenance activities.';
                    break;
                case 'monitoring':
                    reportTitle = 'Monitoring Summary';
                    reportContent = 'Summary of monitoring activities and findings.';
                    break;
                case 'health-trend':
                    reportTitle = 'Ecosystem Health Trend';
                    reportContent = 'Trend report showing changes in ecosystem health over time.';
                    break;
                case 'threat-management':
                    reportTitle = 'Threat Management Report';
                    reportContent = 'Report on threats and management actions taken.';
                    break;
                default:
                    reportTitle = 'Custom Report';
                    reportContent = 'Custom generated report.';
            }
            
            const newReport = {
                id: Date.now(),
                type: type,
                date: new Date().toISOString(),
                generatedBy: db.settings.userProfile.name,
                content: {
                    title: reportTitle,
                    body: reportContent,
                    data: type === 'maintenance' ? db.activities : 
                          type === 'monitoring' ? db.monitoring :
                          type === 'health-trend' ? db.assessments :
                          type === 'threat-management' ? db.complianceChecklist : []
                },
                createdAt: new Date().toISOString()
            };
            
            db.reports.push(newReport);
            if (saveData()) {
                // Show the report
                showReportDetails(newReport);
                
                // Show success message
                showToast('Success', `${reportTitle} generated successfully!`);
            }
        }

        // Generate report from modal
        function generateReportFromModal() {
            const type = document.getElementById('reportType').value;
            if (!type) {
                document.getElementById('reportType').classList.add('is-invalid');
                return;
            }
            
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const format = document.getElementById('reportFormat').value;
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('generateReportModal'));
            if (modal) modal.hide();
            
            // Generate the report
            generateReport(type);
        }

        // Show assessment details
        function showAssessmentDetails(assessment) {
            const modalBody = document.getElementById('assessmentModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Assessment Date</h6>
                        <p>${formatDate(assessment.date)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Assessor</h6>
                        <p>${assessment.assessor}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Site Description</h6>
                    <p>${assessment.description}</p>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Ecosystem Components Present</h6>
                        <ul>
                            ${assessment.components.map(c => `<li>${capitalizeFirstLetter(c)}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Health Assessment</h6>
                        <span class="badge ${getHealthBadgeClass(assessment.health)}">${capitalizeFirstLetter(assessment.health)}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Identified Threats</h6>
                    <p>${assessment.threats.length > 0 ? assessment.threats.map(t => capitalizeFirstLetter(t)).join(', ') : 'None identified'}</p>
                </div>
                
                ${assessment.photos.length > 0 ? `
                <div class="mb-3">
                    <h6>Photos</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${assessment.photos.map(photo => `
                            <img src="${photo}" alt="Assessment photo" class="img-thumbnail" style="max-height: 150px;">
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(assessment.createdAt)}</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewAssessmentModal'));
            modal.show();
        }

        // Show species details
        function showSpeciesDetails(species) {
            const modalBody = document.getElementById('speciesModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Scientific Name</h6>
                        <p>${species.scientificName}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Common Name</h6>
                        <p>${species.commonName || 'Not specified'}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Type</h6>
                        <p>${capitalizeFirstLetter(species.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Status</h6>
                        <span class="badge ${getSpeciesStatusBadgeClass(species.status)}">${capitalizeFirstLetter(species.status)}</span>
                    </div>
                </div>
                
                ${species.description ? `
                <div class="mb-3">
                    <h6>Description</h6>
                    <p>${species.description}</p>
                </div>
                ` : ''}
                
                ${species.habitat ? `
                <div class="mb-3">
                    <h6>Habitat</h6>
                    <p>${species.habitat}</p>
                </div>
                ` : ''}
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Last Observed</h6>
                        <p>${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Record Created</h6>
                        <p>${formatDate(species.createdAt)}</p>
                    </div>
                </div>
                
                ${species.image ? `
                <div class="mb-3">
                    <h6>Image</h6>
                    <img src="${species.image}" alt="${species.scientificName}" class="img-fluid">
                </div>
                ` : ''}
                
                ${species.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${species.notes}</p>
                </div>
                ` : ''}
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewSpeciesModal'));
            modal.show();
        }

        // Show activity details
        function showActivityDetails(activity) {
            const modalBody = document.getElementById('activityModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Activity Type</h6>
                        <p>${formatActivityType(activity.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Title</h6>
                        <p>${activity.title}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Start Date</h6>
                        <p>${formatDateTime(activity.startDate)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>${activity.status === 'completed' ? 'Completed' : 'End'} Date</h6>
                        <p>${activity.endDate ? formatDateTime(activity.endDate) : 'Not specified'}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Location</h6>
                        <p>${activity.location}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Assigned To</h6>
                        <p>${activity.assignedTo}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Priority</h6>
                        <p>${capitalizeFirstLetter(activity.priority)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Status</h6>
                        <span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Description</h6>
                    <p>${activity.description}</p>
                </div>
                
                ${activity.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${activity.notes}</p>
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(activity.createdAt)}</p>
                </div>
            `;
            
            // Set up the complete button if activity is not completed
            const completeBtn = document.getElementById('completeActivity');
            if (completeBtn) {
                if (activity.status === 'completed') {
                    completeBtn.style.display = 'none';
                } else {
                    completeBtn.style.display = 'inline-block';
                    completeBtn.onclick = function() {
                        completeActivity(activity.id);
                    };
                }
            }
            
            const modal = new bootstrap.Modal(document.getElementById('viewActivityModal'));
            modal.show();
        }

        // Show monitoring details
        function showMonitoringDetails(monitoring) {
            const modalBody = document.getElementById('monitoringModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Monitoring Type</h6>
                        <p>${formatMonitoringType(monitoring.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Date</h6>
                        <p>${formatDate(monitoring.date)}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Location</h6>
                        <p>${monitoring.location}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Observer</h6>
                        <p>${monitoring.observer}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Findings</h6>
                    <p>${monitoring.findings}</p>
                </div>
                
                ${monitoring.species.length > 0 ? `
                <div class="mb-3">
                    <h6>Species Observed</h6>
                    <ul>
                        ${monitoring.species.map(s => {
                            const species = db.species.find(sp => sp.id == s);
                            return `<li>${species ? species.scientificName + (species.commonName ? ` (${species.commonName})` : '') : s}</li>`;
                        }).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${monitoring.photos.length > 0 ? `
                <div class="mb-3">
                    <h6>Photos</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${monitoring.photos.map(photo => `
                            <img src="${photo}" alt="Monitoring photo" class="img-thumbnail" style="max-height: 150px;">
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${monitoring.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${monitoring.notes}</p>
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(monitoring.createdAt)}</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewMonitoringModal'));
            modal.show();
        }

        // Show report details
        function showReportDetails(report) {
            const modalBody = document.getElementById('reportModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Report Type</h6>
                        <p>${formatReportType(report.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Generated On</h6>
                        <p>${formatDateTime(report.date)}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Generated By</h6>
                        <p>${report.generatedBy}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Period</h6>
                        <p>${report.period || 'N/A'}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h4>${report.content.title || 'Report'}</h4>
                    <p>${report.content.body || ''}</p>
                </div>
                
                ${report.type === 'compliance' ? `
                <div class="mb-3">
                    <h5>Compliance Progress: ${report.content.progress}%</h5>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: ${report.content.progress}%;" 
                             aria-valuenow="${report.content.progress}" aria-valuemin="0" aria-valuemax="100">
                            ${report.content.progress}%
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h5>Checklist Items</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Requirement</th>
                                <th>Status</th>
                                <th>Evidence</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.checklist.map(item => `
                                <tr>
                                    <td>${item.requirement}</td>
                                    <td>${item.compliant || 'Not assessed'}</td>
                                    <td>${item.evidence || 'None provided'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
                
                ${report.type === 'maintenance' ? `
                <div class="mb-3">
                    <h5>Maintenance Activities</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Activity</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.data.slice(0, 10).map(activity => `
                                <tr>
                                    <td>${activity.title}</td>
                                    <td>${formatActivityType(activity.type)}</td>
                                    <td>${formatDate(activity.startDate)}</td>
                                    <td>${capitalizeFirstLetter(activity.status)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    ${report.content.data.length > 10 ? `<p>... and ${report.content.data.length - 10} more activities</p>` : ''}
                </div>
                ` : ''}
                
                ${report.type === 'monitoring' ? `
                <div class="mb-3">
                    <h5>Monitoring Activities</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Observer</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.data.slice(0, 10).map(monitoring => `
                                <tr>
                                    <td>${formatMonitoringType(monitoring.type)}</td>
                                    <td>${formatDate(monitoring.date)}</td>
                                    <td>${monitoring.location}</td>
                                    <td>${monitoring.observer}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    ${report.content.data.length > 10 ? `<p>... and ${report.content.data.length - 10} more records</p>` : ''}
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(report.createdAt)}</p>
                </div>
            `;
            
            // Set up the download button
            const downloadBtn = document.getElementById('downloadReport');
            if (downloadBtn) {
                downloadBtn.onclick = function() {
                    downloadReport(report);
                };
            }
            
            const modal = new bootstrap.Modal(document.getElementById('viewReportModal'));
            modal.show();
        }

        // Complete activity
        function completeActivity(activityId) {
            const activity = db.activities.find(a => a.id == activityId);
            if (activity) {
                activity.status = 'completed';
                activity.endDate = new Date().toISOString();
                if (saveData()) {
                    // Close the modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('viewActivityModal'));
                    if (modal) modal.hide();
                    
                    // Show success message
                    showToast('Success', 'Activity marked as completed!');
                    
                    // Reload activities
                    loadActivities();
                    if (window.calendar) {
                        window.calendar.refetchEvents();
                    }
                }
            }
        }

        // Download report
        function downloadReport(report) {
            // In a real app, this would generate a PDF or other format
            // For demo, we'll just show a message
            showToast('Info', 'Report download would be generated here in a real application', 'info');
        }

        // Show confirmation dialog
        function showConfirmation(title, message, confirmCallback) {
            const modalBody = document.getElementById('confirmationModalBody');
            if (!modalBody) return;
            
            modalBody.innerHTML = message;
            
            document.getElementById('confirmationModalLabel').textContent = title;
            
            const confirmBtn = document.getElementById('confirmAction');
            if (confirmBtn) {
                confirmBtn.onclick = function() {
                    confirmCallback();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
                    if (modal) modal.hide();
                };
            }
            
            const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            modal.show();
        }

        // Validate components selection
        function validateComponents() {
            const selectedComponents = Array.from(document.querySelectorAll('input[name="components"]:checked')).map(cb => cb.value);
            const componentsFeedback = document.getElementById('componentsFeedback');
            if (componentsFeedback) {
                if (selectedComponents.length === 0) {
                    componentsFeedback.style.display = 'block';
                } else {
                    componentsFeedback.style.display = 'none';
                }
            }
        }

        // Export dashboard
        function exportDashboard() {
            showToast('Info', 'Dashboard export functionality would be implemented here', 'info');
        }

        // Print dashboard
        function printDashboard() {
            window.print();
        }

        // Export species
        function exportSpecies() {
            const dataStr = JSON.stringify(db.species, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `species-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Success', 'Species data exported successfully!');
        }

        // Print species
        function printSpecies() {
            // Create a printable version of the species table
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Species Register</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Species Register</h1>
                    <table>
                        <thead>
                            <tr>
                                <th>Scientific Name</th>
                                <th>Common Name</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Last Observed</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${db.species.map(species => `
                                <tr>
                                    <td>${species.scientificName}</td>
                                    <td>${species.commonName || '-'}</td>
                                    <td>${capitalizeFirstLetter(species.type)}</td>
                                    <td>${capitalizeFirstLetter(species.status)}</td>
                                    <td>${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // View all fauna
        function viewAllFauna() {
            // Switch to monitoring tab and filter for fauna
            const monitoringTab = document.querySelector('a[href="#monitoring"]');
            if (monitoringTab) {
                monitoringTab.click();
                
                // In a real implementation, we would filter the monitoring table
                setTimeout(() => {
                    showToast('Info', 'Viewing all fauna monitoring records', 'info');
                }, 500);
            }
        }

        // View all vegetation
        function viewAllVegetation() {
            // Switch to monitoring tab and filter for vegetation
            const monitoringTab = document.querySelector('a[href="#monitoring"]');
            if (monitoringTab) {
                monitoringTab.click();
                
                // In a real implementation, we would filter the monitoring table
                setTimeout(() => {
                    showToast('Info', 'Viewing all vegetation monitoring records', 'info');
                }, 500);
            }
        }

        // Helper function to capitalize first letter
        function capitalizeFirstLetter(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return 'Not specified';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Helper function to format date and time
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'Not specified';
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString(undefined, options);
        }

        // Helper function to format activity type
        function formatActivityType(type) {
            switch(type) {
                case 'weed-control': return 'Weed Control';
                case 'revegetation': return 'Revegetation';
                case 'erosion-control': return 'Erosion Control';
                case 'fauna-survey': return 'Fauna Survey';
                case 'vegetation-survey': return 'Vegetation Survey';
                case 'water-quality': return 'Water Quality';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to format monitoring type
        function formatMonitoringType(type) {
            switch(type) {
                case 'fauna-survey': return 'Fauna Survey';
                case 'vegetation-survey': return 'Vegetation Survey';
                case 'water-quality': return 'Water Quality Testing';
                case 'weed-mapping': return 'Weed Mapping';
                case 'erosion-monitoring': return 'Erosion Monitoring';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to format report type
        function formatReportType(type) {
            switch(type) {
                case 'compliance': return 'Compliance Report';
                case 'maintenance': return 'Maintenance Summary';
                case 'monitoring': return 'Monitoring Summary';
                case 'health-trend': return 'Ecosystem Health Trend';
                case 'threat-management': return 'Threat Management';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'completed': return 'bg-success';
                case 'in-progress': return 'bg-info';
                case 'planned': return 'bg-primary';
                case 'cancelled': return 'bg-secondary';
                default: return 'bg-light text-dark';
            }
        }

        // Helper function to get health badge class
        function getHealthBadgeClass(health) {
            switch(health) {
                case 'excellent': return 'bg-success';
                case 'good': return 'bg-success';
                case 'fair': return 'bg-warning';
                case 'poor': return 'bg-danger';
                case 'degraded': return 'bg-danger';
                default: return 'bg-light text-dark';
            }
        }

        // Helper function to get species status badge class
        function getSpeciesStatusBadgeClass(status) {
            switch(status) {
                case 'native': return 'bg-success';
                case 'introduced': return 'bg-secondary';
                case 'weed': return 'bg-danger';
                case 'pest': return 'bg-danger';
                case 'endangered': return 'bg-danger';
                case 'vulnerable': return 'bg-warning';
                case 'threatened': return 'bg-warning';
                default: return 'bg-light text-dark';
            }
        }

        // Initialize with some test data if empty
        if (db.assessments.length === 0) {
            db.assessments = [
                {
                    id: 1,
                    date: '2023-06-15',
                    assessor: 'Jane Doe',
                    description: 'Initial assessment of the northern section of the conservation area. Found healthy native vegetation but some weed infestations.',
                    components: ['flora', 'fauna', 'soil'],
                    health: 'good',
                    threats: ['weeds', 'erosion'],
                    photos: [],
                    createdAt: '2023-06-15T10:30:00Z'
                },
                {
                    id: 2,
                    date: '2023-03-02',
                    assessor: 'John Smith',
                    description: 'Quarterly assessment of the entire site. Noted increased weed coverage in Zone 3.',
                    components: ['flora', 'fauna', 'water'],
                    health: 'fair',
                    threats: ['weeds', 'pests'],
                    photos: [],
                    createdAt: '2023-03-02T14:15:00Z'
                }
            ];
        }

        if (db.species.length === 0) {
            db.species = [
                {
                    id: 1,
                    scientificName: 'Eucalyptus pauciflora',
                    commonName: 'Snow Gum',
                    type: 'flora',
                    status: 'native',
                    description: 'A small to medium-sized tree with smooth bark, native to southeastern Australia.',
                    habitat: 'Alpine and subalpine areas',
                    lastObserved: '2023-06-15',
                    image: 'https://via.placeholder.com/300x200?text=Eucalyptus+pauciflora',
                    notes: 'Dominant species in Zone 1',
                    createdAt: '2023-01-10T09:20:00Z'
                },
                {
                    id: 2,
                    scientificName: 'Rubus fruticosus',
                    commonName: 'Blackberry',
                    type: 'flora',
                    status: 'weed',
                    description: 'Invasive shrub with thorny stems and edible black berries.',
                    habitat: 'Disturbed areas, forest edges',
                    lastObserved: '2023-06-10',
                    image: 'https://via.placeholder.com/300x200?text=Rubus+fruticosus',
                    notes: 'Expanding in Zone 3, requires control',
                    createdAt: '2023-02-15T11:45:00Z'
                },
                {
                    id: 3,
                    scientificName: 'Phascolarctos cinereus',
                    commonName: 'Koala',
                    type: 'fauna',
                    status: 'endangered',
                    description: 'Arboreal herbivorous marsupial native to Australia.',
                    habitat: 'Eucalyptus forests',
                    lastObserved: '2023-06-05',
                    image: 'https://via.placeholder.com/300x200?text=Phascolarctos+cinereus',
                    notes: 'Single individual observed in Zone 1',
                    createdAt: '2023-03-20T08:30:00Z'
                }
            ];
        }

        if (db.activities.length === 0) {
            db.activities = [
                {
                    id: 1,
                    type: 'weed-control',
                    title: 'Weed Control - Blackberry',
                    startDate: '2023-06-25T09:00:00',
                    endDate: null,
                    location: 'Zone 3',
                    description: 'Target species: Blackberry. Manual removal and herbicide application.',
                    assignedTo: 'John Smith',
                    priority: 'high',
                    status: 'planned',
                    notes: 'Wear protective clothing due to thorns',
                    createdAt: '2023-06-10T14:30:00Z'
                },
                {
                    id: 2,
                    type: 'fauna-survey',
                    title: 'Fauna Survey - Eastern Zone',
                    startDate: '2023-06-28T08:00:00',
                    endDate: '2023-06-28T16:00:00',
                    location: 'Eastern Zone',
                    description: 'Standardized survey of fauna species in the eastern section.',
                    assignedTo: 'Survey Team',
                    priority: 'medium',
                    status: 'planned',
                    notes: 'Focus on threatened species',
                    createdAt: '2023-05-20T10:15:00Z'
                },
                {
                    id: 3,
                    type: 'revegetation',
                    title: 'Revegetation Planting',
                    startDate: '2023-07-05T09:00:00',
                    endDate: '2023-07-05T15:00:00',
                    location: 'Zone 1',
                    description: 'Planting 200 native shrubs in previously cleared area.',
                    assignedTo: 'Volunteer Group',
                    priority: 'medium',
                    status: 'planned',
                    notes: 'Species: Acacia and Banksia',
                    createdAt: '2023-06-01T11:20:00Z'
                },
                {
                    id: 4,
                    type: 'erosion-control',
                    title: 'Erosion Control - North Bank',
                    startDate: '2023-06-15T08:00:00',
                    endDate: '2023-06-15T16:00:00',
                    location: 'Northern Boundary',
                    description: 'Install erosion control matting and plant stabilizing vegetation.',
                    assignedTo: 'Grounds Team',
                    priority: 'high',
                    status: 'completed',
                    notes: 'Completed on schedule',
                    createdAt: '2023-05-25T09:45:00Z'
                }
            ];
        }

        if (db.monitoring.length === 0) {
            db.monitoring = [
                {
                    id: 1,
                    type: 'vegetation-survey',
                    date: '2023-06-15',
                    location: 'Zone 1',
                    observer: 'Jane Doe',
                    findings: 'Increased native cover compared to last survey. Weed cover reduced by 15%.',
                    species: [1],
                    photos: [],
                    notes: 'Positive trend in vegetation recovery',
                    createdAt: '2023-06-15T16:45:00Z'
                },
                {
                    id: 2,
                    type: 'fauna-survey',
                    date: '2023-06-12',
                    location: 'Eastern Zone',
                    observer: 'Survey Team',
                    findings: 'Koala sighting confirmed. Also observed several bird species including bush stone-curlew.',
                    species: [3],
                    photos: [],
                    notes: 'First confirmed koala sighting in 2 years',
                    createdAt: '2023-06-12T17:30:00Z'
                },
                {
                    id: 3,
                    type: 'water-quality',
                    date: '2023-06-10',
                    location: 'Main Creek',
                    observer: 'John Smith',
                    findings: 'Good water quality with normal parameters. No signs of pollution.',
                    species: [],
                    photos: [],
                    notes: 'Tested pH, turbidity, and dissolved oxygen',
                    createdAt: '2023-06-10T12:15:00Z'
                },
                {
                    id: 4,
                    type: 'weed-mapping',
                    date: '2023-06-05',
                    location: 'Zone 3',
                    observer: 'Grounds Team',
                    findings: 'Blackberry expansion noted in western part of Zone 3. Approximately 20% increase in coverage.',
                    species: [2],
                    photos: [],
                    notes: 'Schedule control measures',
                    createdAt: '2023-06-05T14:20:00Z'
                }
            ];
        }

        if (db.reports.length === 0) {
            db.reports = [
                {
                    id: 1,
                    type: 'compliance',
                    date: '2023-06-01',
                    generatedBy: 'Jane Doe',
                    period: 'May 2023',
                    content: {
                        title: 'Monthly Compliance Report',
                        body: 'Compliance with AHCECR301 requirements for May 2023.',
                        progress: 60,
                        checklist: db.complianceChecklist
                    },
                    createdAt: '2023-06-01T10:00:00Z'
                },
                {
                    id: 2,
                    type: 'maintenance',
                    date: '2023-05-01',
                    generatedBy: 'Jane Doe',
                    period: 'April 2023',
                    content: {
                        title: 'Monthly Maintenance Summary',
                        body: 'Summary of maintenance activities for April 2023.',
                        data: []
                    },
                    createdAt: '2023-05-01T09:30:00Z'
                }
            ];
        }

        // Save initial data
        saveData();
    </script>
</body>
</html>
