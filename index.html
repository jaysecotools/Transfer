No, you don't need to apply ALL of them at once. Let me give you a more practical approach - start with the simplest solution first and then add more if needed.

Start with Solution 2 + Solution 3 (The Quick Fix)

Just add these two functions and modify your existing ones:

Add this function to your script:

```javascript
function refreshMapWhenVisible(containerId, stateKey) {
  const container = document.getElementById(containerId);
  if (!container || !state[stateKey]) return;
  
  // Use a small delay to ensure the container is visible
  setTimeout(() => {
    if (state[stateKey]) {
      state[stateKey].invalidateSize();
      // Force a second refresh to be sure
      setTimeout(() => {
        state[stateKey].invalidateSize();
      }, 100);
    }
  }, 300);
}
```

Then modify your showProjectForm function - find this function and add the refresh call:

```javascript
function showProjectForm(projectId = null) {
  try {
    const formContainer = document.getElementById('project-form-container');
    const formTitle = document.getElementById('project-form-title');
    const previewContainer = document.getElementById('photo-preview');
    
    // Show the form first
    document.getElementById('projects-list').style.display = 'none';
    formContainer.style.display = 'block';
    
    // ADD THIS: Refresh the map after showing the form
    setTimeout(() => {
      refreshMapWhenVisible('project-location-map', 'projectLocationMap');
    }, 100);
    
    // ... rest of your existing showProjectForm code continues unchanged
    if (projectId) {
      // ... your existing code
    } else {
      // ... your existing code
    }
    
  } catch (error) {
    console.error('Error showing project form:', error);
    showToast('Error loading project form: ' + error.message, 'error');
  }
}
```

Also modify your showSection function to handle the monitoring tab:

```javascript
function showSection(sectionId) {
  try {
    // ... your existing code
    
    // ADD THIS: Refresh maps when switching sections
    setTimeout(() => {
      switch(sectionId) {
        case 'projects':
          refreshMapWhenVisible('projects-map', 'projectMap');
          break;
        case 'monitoring':
          // Refresh monitoring map when switching to monitoring tab
          setTimeout(() => {
            refreshMapWhenVisible('monitoring-location-map', 'monitoringLocationMap');
          }, 200);
          break;
      }
    }, 300);
    
    state.selectedTab = sectionId;
  } catch (error) {
    console.error('Error showing section:', error);
    showToast('Error navigating: ' + error.message, 'error');
  }
}
```

If that doesn't work completely, then also add:

Modify your showMonitoringTab function:

```javascript
function showMonitoringTab(tabId) {
  try {
    // ... your existing code
    
    if (tabId === 'new') {
      populateProjectDropdown('monitoring-project');
      document.getElementById('monitoring-photo-preview').innerHTML = '';
      state.tempPhotos.monitoring = [];
      
      // ADD THIS: Refresh the monitoring map when showing the "new" tab
      setTimeout(() => {
        refreshMapWhenVisible('monitoring-location-map', 'monitoringLocationMap');
      }, 100);
    }
    
  } catch (error) {
    console.error('Error showing monitoring tab:', error);
    showToast('Error switching tabs: ' + error.message, 'error');
  }
}
```

Summary of what to do:

1. Add the refreshMapWhenVisible function to your script
2. Add the refresh calls to showProjectForm, showSection, and showMonitoringTab

This should solve 90% of your map display issues. The key is calling invalidateSize() on the Leaflet map after the container becomes visible, with proper timing delays.

Try this first - it's much simpler than completely rewriting your map initialization code, and it will likely fix the grey map problem.
