Looking at your code, I can identify the main issue with navigation. The problem is in the setupNavigation() function and how you're handling the click events for the sidebar navigation links.

Main Issues:

1. Event Listener Conflicts

You have both:

· setupNavigation() which attaches an event listener to the sidebar
· setupFormHandlers() which also tries to handle navigation via the quick action buttons

These can conflict, especially since you're using setTimeout() in both.

2. Race Conditions

The setTimeout(() => {...}, 50) calls can cause timing issues. If a user clicks quickly, multiple timeouts might fire and sections could get into a confused state.

3. Inconsistent Section Activation

Sometimes you're trying to activate sections before they're properly hidden.

Fixed Code:

Replace your entire setupNavigation() function with this simplified version:

```javascript
function setupNavigation() {
    // Use event delegation for dynamic content
    document.querySelector('.sidebar').addEventListener('click', function(e) {
        const navLink = e.target.closest('.nav-link');
        if (!navLink || navLink.id === 'userGuideBtn') return;
        
        e.preventDefault();
        e.stopPropagation(); // Prevent event bubbling
        
        const target = navLink.getAttribute('data-target');
        if (!target) return;
        
        // Update active state
        document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
        navLink.classList.add('active');
        
        // Hide all sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Show the target section
        const targetSection = document.getElementById(target);
        if (targetSection) {
            targetSection.classList.add('active');
            loadSectionData(target);
            
            // Update page title
            const span = navLink.querySelector('span');
            if (span) {
                document.title = `${span.textContent} | EcoManager Pro`;
            }
        }
    });
}

// Helper function to load section data
function loadSectionData(sectionId) {
    switch(sectionId) {
        case 'dashboard':
            loadDashboard();
            break;
        case 'projects':
            loadProjects();
            setTimeout(() => {
                if (!projectMap) initProjectMap();
            }, 100);
            break;
        case 'assessments':
            loadAssessments();
            break;
        case 'species':
            loadSpecies();
            break;
        case 'maintenance':
            loadMaintenance();
            // Reset to list view when navigating to maintenance
            const listViewBtn = document.querySelector('[data-view="list-view"]');
            if (listViewBtn) listViewBtn.click();
            break;
        case 'charts':
            loadCharts();
            break;
        case 'data':
            loadDataSummary();
            loadProjectSelects();
            break;
        case 'weather':
            loadWeatherData();
            break;
    }
}
```

Also, update the quick action button handlers in setupFormHandlers() to use the same logic:

```javascript
// In setupFormHandlers(), replace the quick action handlers section with:
document.querySelectorAll('.quick-action-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const target = this.dataset.target;
        if (!target) return;
        
        // Update sidebar active state
        document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
        const navLink = document.querySelector(`[data-target="${target}"]`);
        if (navLink) navLink.classList.add('active');
        
        // Hide all sections and show target
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        
        const targetSection = document.getElementById(target);
        if (targetSection) {
            targetSection.classList.add('active');
            loadSectionData(target);
        }
    });
});
```

Additional Fixes Needed:

1. Remove duplicate initialization

Make sure you're only calling setupNavigation() once in your initApp() function.

2. Fix the User Guide button handler

Update the User Guide button handler to avoid conflicts:

```javascript
// User Guide button - keep this separate from main navigation
const userGuideBtn = document.getElementById('userGuideBtn');
if (userGuideBtn) {
    userGuideBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        // Update active state
        document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        // Hide all content sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Create or show User Guide section
        showUserGuideSection();
    });
}
```

3. Ensure sections exist on DOM load

Add this at the end of your initApp() function to ensure initial state is correct:

```javascript
// Ensure dashboard is the only active section on load
document.querySelectorAll('.content-section').forEach(section => {
    if (section.id !== 'dashboard') {
        section.classList.remove('active');
    }
});

// Set dashboard as active in sidebar
document.querySelectorAll('.sidebar .nav-link').forEach(link => {
    if (link.getAttribute('data-target') === 'dashboard') {
        link.classList.add('active');
    } else {
        link.classList.remove('active');
    }
});
```

Key Changes Made:

1. Removed setTimeout() calls - These were causing race conditions
2. Added e.stopPropagation() - Prevents event bubbling to parent elements
3. Created loadSectionData() helper - Centralized section loading logic
4. Simplified navigation logic - No more nested timeouts that could conflict
5. Fixed event delegation - Better targeting of click events

This should resolve the navigation issues. The main problem was the asynchronous setTimeout() calls that could fire out of order when users clicked quickly, causing sections to appear/disappear incorrectly.
