Looking at your code, the issue is that manually entered units (from the "Other Units" section) aren't being properly saved and loaded with the rest of the student data. Here are the key changes needed:

1. Update the saveStudentData() function

Replace your current saveStudentData() function with this updated version:

```javascript
function saveStudentData() {
  const studentName = document.getElementById("studentName").value.trim();
  if (!studentName) {
    alert("Please enter a student name before saving.");
    return;
  }

  // Get current form data
  const studentData = {
    id: document.getElementById("studentId").value,
    name: studentName,
    startDate: document.getElementById("startDate").value,
    notes: document.getElementById("notes").value,
    overrideRules: document.getElementById("overrideRules").checked,
    scheduleMode: document.querySelector('input[name="scheduleMode"]:checked').value,
    selectedUnits: getSelectedUnits(), // This now includes custom units
    customUnits: getCustomUnitsData(),
    unitDurations: getUnitDurations(),
    unitQuarters: getUnitQuarters(),
    timestamp: new Date().toISOString()
  };

  // Get existing saved students
  const savedStudents = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  
  // Check if student already exists
  const existingIndex = savedStudents.findIndex(s => 
    s.name === studentData.name && 
    (s.id === studentData.id || (!s.id && !studentData.id))
  );
  
  if (existingIndex >= 0) {
    // Update existing student
    if (confirm(`A student named "${studentData.name}" already exists. Do you want to overwrite it?`)) {
      savedStudents[existingIndex] = studentData;
    } else {
      return; // User canceled
    }
  } else {
    // Add new student
    savedStudents.push(studentData);
  }
  
  // Save to localStorage
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedStudents));
  
  // Update the saved students list
  updateSavedStudentsList();
  
  alert(`Student data for "${studentData.name}" has been saved.`);
}
```

2. Update the getCustomUnitsData() function

Make sure your getCustomUnitsData() function properly captures all custom units:

```javascript
function getCustomUnitsData() {
  const customUnits = [];
  document.querySelectorAll("[id^='otherUnitCheckbox-']").forEach(cb => {
    const id = cb.id.split("-")[1];
    customUnits.push({
      id: id,
      details: document.getElementById(`otherUnitDetails-${id}`).value,
      groupType: document.getElementById(`otherUnitGroup-${id}`).value,
      duration: document.getElementById(`otherUnitDuration-${id}`).value,
      quarter: document.getElementById(`otherUnitQuarter-${id}`).value,
      checked: cb.checked
    });
  });
  return customUnits;
}
```

3. Update the selectStudentToLoad() function

Replace the custom units restoration section in selectStudentToLoad() with this improved version:

```javascript
// Restore custom units
if (student.customUnits) {
  // Clear any existing custom units first
  document.getElementById("otherUnitsList").innerHTML = "";
  
  // Add each custom unit back
  student.customUnits.forEach(customUnit => {
    addOtherUnit(customUnit.groupType);
    
    // Get the most recently added custom unit (last one)
    const customUnits = document.querySelectorAll('.other-unit');
    const lastCustomUnit = customUnits[customUnits.length - 1];
    
    if (lastCustomUnit) {
      // Extract the ID from the newly created unit
      const newCheckbox = lastCustomUnit.querySelector('[id^="otherUnitCheckbox-"]');
      if (newCheckbox) {
        const newId = newCheckbox.id.split("-")[1];
        
        // Set all the values
        document.getElementById(`otherUnitDetails-${newId}`).value = customUnit.details || "";
        document.getElementById(`otherUnitDuration-${newId}`).value = customUnit.duration || 6;
        document.getElementById(`otherUnitQuarter-${newId}`).value = customUnit.quarter || 1;
        document.getElementById(`otherUnitCheckbox-${newId}`).checked = customUnit.checked !== false;
      }
    }
  });
}
```

4. Update the addOtherUnit() function

Modify the addOtherUnit() function to ensure proper ID handling:

```javascript
function addOtherUnit(groupType) {
  const otherUnitsList = document.getElementById("otherUnitsList");
  const newId = 'custom_' + Date.now(); // Use a more unique ID
  
  const groupLabel = {
    'AtoH': 'Groups A-H',
    'groupI': 'Group I',
    'imported': 'Imported'
  }[groupType] || 'Custom';
  
  const otherUnitDiv = document.createElement("div");
  otherUnitDiv.className = "other-unit";
  otherUnitDiv.innerHTML = `
    <label>
      <input type="checkbox" id="otherUnitCheckbox-${newId}" checked>
      ${groupLabel} Unit:
      <input type="text" id="otherUnitDetails-${newId}" placeholder="Unit code and name" required>
      <span class="duration-input">
        &nbsp; Duration (weeks): <input type="number" min="1" value="6" class="duration" id="otherUnitDuration-${newId}">
      </span>
      <span class="quarter-selector">
        Quarter: <select class="quarter-select" id="otherUnitQuarter-${newId}">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </span>
    </label>
    <input type="hidden" id="otherUnitGroup-${newId}" value="${groupType}">
    <button class="remove-other-unit" onclick="removeOtherUnit('${newId}')">Ã—</button>
  `;
  otherUnitsList.appendChild(otherUnitDiv);
  
  updateValidationIndicator();
  updateQuarterSelectorsVisibility();
  
  return newId; // Return the ID for potential use
}
```

5. Update the removeOtherUnit() function

```javascript
function removeOtherUnit(id) {
  const unitToRemove = document.querySelector(`#otherUnitCheckbox-${id}`).closest('.other-unit');
  if (unitToRemove) {
    unitToRemove.remove();
    updateValidationIndicator();
  }
}
```

Key Changes Made:

1. Better ID handling: Using 'custom_' + Date.now() for more unique IDs
2. Proper data capture: Ensuring all custom unit data is saved including checked state
3. Correct restoration: Properly recreating custom units with all their properties when loading
4. Consistent data structure: Making sure the saved data structure matches what's needed for loading

These changes will ensure that when you save a student's data, all manually entered units (from the "Other Units" section) are properly saved along with the standard units, and they'll be correctly restored when you load the student data later.
