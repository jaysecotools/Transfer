You're right, that was too complex! Let me give you the simplest fix possible - just two small changes:

Fix 1: Replace your showProjectInModal() function with this:

```javascript
function showProjectInModal(projectId) {
    console.log("Opening map for project ID:", projectId);
    
    // Find the project by ID
    const projects = db.getProjects();
    const project = projects.find(p => p.id === projectId);
    
    if (!project) {
        console.error("Project not found with ID:", projectId);
        showToast('Error', 'Project not found', 'error');
        return;
    }
    
    console.log("Found project:", project);
    
    // Update modal content
    document.getElementById('projectMapModalTitle').textContent = `${project.name} Location`;
    
    const modalCoordinates = document.getElementById('modalCoordinates');
    if (project.latitude && project.longitude) {
        const lat = parseFloat(project.latitude);
        const lng = parseFloat(project.longitude);
        modalCoordinates.textContent = `Coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
    } else {
        modalCoordinates.textContent = 'Coordinates: Not specified';
    }
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('projectMapModal'));
    modal.show();
    
    // Wait for modal to be visible, then create the map
    setTimeout(() => {
        const mapContainer = document.getElementById('modalProjectMap');
        
        // Clear any existing map
        mapContainer.innerHTML = '<div id="freshMap" style="height: 100%; width: 100%;"></div>';
        
        // Set location (use project location or default)
        let lat = -41.0521;
        let lng = 145.9061;
        let zoom = 11;
        
        if (project.latitude && project.longitude) {
            lat = parseFloat(project.latitude);
            lng = parseFloat(project.longitude);
            zoom = 13;
        }
        
        // Create the map
        const map = L.map('freshMap').setView([lat, lng], zoom);
        
        // Add map tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        // Add marker if project has coordinates
        if (project.latitude && project.longitude) {
            L.marker([lat, lng])
                .addTo(map)
                .bindPopup(`<b>${project.name}</b>`)
                .openPopup();
        }
        
        // Fix map size
        setTimeout(() => {
            map.invalidateSize();
        }, 100);
        
    }, 300); // Small delay to ensure modal is visible
}
```

Fix 2: Find this section in your loadProjects() function and change ONE LINE:

Look for this part in your code:

```javascript
<button class="btn btn-sm btn-outline-primary" 
        onclick="showProjectInModal(${JSON.stringify(project).replace(/"/g, '&quot;')})">
    <i class="bi bi-eye"></i> View
</button>
```

Change it to this (just pass the ID instead of the whole object):

```javascript
<button class="btn btn-sm btn-outline-primary" 
        onclick="showProjectInModal('${project.id}')">
    <i class="bi bi-eye"></i> View
</button>
```

Also find this similar line (the map-preview div) and change it too:

```javascript
<div class="map-preview me-2" 
     style="width: 100px; background-color: #f8f9fa;"
     onclick="showProjectInModal('${project.id}')">
```

That's it! Just those 2 changes:

1. Replace the entire showProjectInModal() function
2. Change the two onclick handlers to pass '${project.id}' instead of the complex JSON

This works because we're only passing the simple project ID string, then looking up the project data inside the function. No JSON parsing issues!

Try these minimal changes and it should work perfectly.
