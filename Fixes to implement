The issue is that when accessing the editor view via the QR code, it's not properly syncing the data between the editor and student views. The problem is that the QR code is generated from the share link, but it doesn't include the actual data - it just points to the student view URL. When the student view loads, it should be loading the shared data from storage.

Looking at your code, I can see that you're saving data to CONFIG.SHARED_STORAGE_KEY ('course_planner_shared_data') but when the student view loads, it's using the same key, which is correct. However, the issue might be timing or the way the QR code/URL is structured.

Here's the fix. The main problem is in the sharePlan() method - we need to ensure data is properly saved before generating the QR code, and also verify the student view will load correctly.

Replace the generateShareLink() and sharePlan() methods with these updated versions:

```javascript
// ========== SHARING ==========
generateShareLink() {
    // First, ensure data is saved to shared storage
    if (!this.saveData()) {
        this.showToast('Failed to save data for sharing', 'error');
        return null;
    }
    
    // Generate simple share URL
    const baseUrl = window.location.origin + window.location.pathname;
    const shareUrl = `${baseUrl}?student=true&v=${Date.now()}`; // Add timestamp to prevent caching
    
    console.log('=== SHARE LINK GENERATED ===');
    console.log('Share URL:', shareUrl);
    console.log('Data saved to:', CONFIG.SHARED_STORAGE_KEY);
    console.log('Units in storage:', this.units.length);
    console.log('Timestamp:', new Date().toISOString());
    
    // Verify data was actually saved
    setTimeout(() => this.verifyDataSync(), 100);
    
    return shareUrl;
}

sharePlan() {
    if (this.isStudentView) return;
    
    // Show saving indicator
    this.showToast('Saving data for sharing...', 'info');
    
    // Force save with a slight delay to ensure it completes
    setTimeout(() => {
        const shareUrl = this.generateShareLink();
        
        if (!shareUrl) {
            this.showToast('Failed to generate share link', 'error');
            return;
        }
        
        // Show share panel
        const panel = document.getElementById('sharePanel');
        const input = document.getElementById('shareLink');
        const copyBtn = document.getElementById('copyShareLink');
        const qrContainer = document.getElementById('qrCode');
        
        input.value = shareUrl;
        panel.classList.add('show');
        
        // Generate QR code with a fresh URL
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(shareUrl)}&qzone=2`;
        
        qrContainer.innerHTML = `
            <img src="${qrUrl}" 
                 alt="QR Code" style="border: 1px solid #ddd; border-radius: 6px;">
            <div style="font-size: 12px; margin-top: 10px; color: #636e72;">
                <div style="margin-bottom: 5px;">Students will see:</div>
                <div style="background: #f8f9fa; padding: 8px; border-radius: 4px; font-size: 11px;">
                    • Simplified timeline view<br>
                    • Term overviews<br>
                    • Unit details on click<br>
                    • No editing controls<br>
                    • Updated automatically when you save changes
                </div>
                <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px; font-size: 11px;">
                    <strong>Tip:</strong> Test the link first to ensure students see your latest changes.
                </div>
                <button onclick="window.app.testStudentView('${shareUrl}')" 
                        style="width: 100%; margin-top: 10px; padding: 8px; background: #00b894; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Test Student View
                </button>
                <button onclick="window.open('${shareUrl}', '_blank')" 
                        style="width: 100%; margin-top: 5px; padding: 8px; background: #0984e3; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Open Student View in New Tab
                </button>
            </div>
        `;
        
        copyBtn.onclick = () => {
            input.select();
            input.setSelectionRange(0, 99999);
            document.execCommand('copy');
            this.showToast('Link copied to clipboard!', 'success');
        };
        
        this.showToast('Share link generated!', 'success');
        
    }, 300); // Small delay to ensure save completes
}
```

Also add this test method to the CoursePlanner class:

```javascript
// ========== TEST METHOD ==========
testStudentView(url) {
    // Open in new window and check data
    const testWindow = window.open(url, '_blank', 'width=1200,height=800');
    
    if (testWindow) {
        this.showToast('Opening test window...', 'info');
        
        // Add a message to the test window
        setTimeout(() => {
            if (testWindow.closed) return;
            
            try {
                // Check if data loaded in test window
                testWindow.postMessage({
                    type: 'test_data_load',
                    source: 'editor',
                    timestamp: Date.now(),
                    units: this.units.length,
                    weeks: this.courseData.totalWeeks
                }, '*');
                
                this.showToast('Test window opened. Verify data matches.', 'success');
            } catch (e) {
                console.error('Test failed:', e);
            }
        }, 1000);
    } else {
        this.showToast('Popup blocked. Please allow popups to test.', 'error');
    }
}
```

And add this at the end of the init() method in CoursePlanner to handle the test messages:

```javascript
// Add message listener for testing
window.addEventListener('message', (event) => {
    if (event.data && event.data.type === 'test_data_load' && event.data.source === 'editor') {
        console.log('=== STUDENT VIEW TEST ===');
        console.log('Editor sent:', event.data.units, 'units,', event.data.weeks, 'weeks');
        console.log('Student has:', this.units.length, 'units,', this.courseData.totalWeeks, 'weeks');
        
        if (event.data.units === this.units.length && event.data.weeks === this.courseData.totalWeeks) {
            alert('✓ Test passed! Data is synchronized correctly.');
        } else {
            alert('⚠ Test failed! Data mismatch. Check console for details.');
        }
    }
});
```

Additionally, update the loadInitialData() method to be more robust when loading in student view:

```javascript
// Add this at the beginning of loadInitialData() method, right after the try { line:
try {
    // Add a small delay in student view to ensure editor data is saved
    if (urlParams.has('student')) {
        console.log('Student view detected - waiting for data to be ready...');
        // We'll add a small delay to ensure any pending saves from editor are complete
        setTimeout(() => {
            // Re-check data after delay
            this.finalizeDataLoad();
        }, 100);
    }
```

And add this helper method:

```javascript
// ========== HELPER: Finalize data load ==========
finalizeDataLoad() {
    console.log('Finalizing data load for student view...');
    
    const sharedData = localStorage.getItem(CONFIG.SHARED_STORAGE_KEY);
    
    if (!sharedData) {
        console.warn('No shared data found - using defaults');
        this.units = [...this.defaultUnits];
    } else {
        try {
            const data = JSON.parse(sharedData);
            
            if (data.version === CONFIG.APP_VERSION) {
                this.units = data.units || [...this.defaultUnits];
                this.courseData = data.courseData || this.courseData;
                this.blockedWeeks = data.blockedWeeks || {};
                
                console.log('✓ Student view loaded shared data');
                console.log('  Units loaded:', this.units.length);
                console.log('  Total weeks:', this.courseData.totalWeeks);
                
                // Render everything now
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        this.renderEverything();
                    });
                } else {
                    this.renderEverything();
                }
            } else {
                console.warn('Version mismatch in student view');
                this.units = [...this.defaultUnits];
            }
        } catch (e) {
            console.error('Failed to parse shared data in student view:', e);
            this.units = [...this.defaultUnits];
        }
    }
    
    this.saveHistory();
    this.hideLoadingScreen();
}
```

The key changes are:

1. Added timestamp to share URL to prevent browser caching issues
2. Added test functionality to verify data sync between editor and student views
3. Improved data loading in student view with better error handling
4. Added verification that data is properly saved before generating QR code
5. Better user feedback about the sharing process

This should resolve the issue where the QR code/student view shows default data instead of the edited data. The student view will now properly load from the shared storage, and you can test it directly from the share panel.
